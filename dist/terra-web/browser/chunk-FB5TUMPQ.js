import{a as W,b as Y}from"./chunk-EDNFDHML.js";import{b as G,c as v,d as R,e as N,h as z,k as j,l as q,t as B,v as D}from"./chunk-3TE735WS.js";import{a as A}from"./chunk-OPESTRHU.js";import{e as L,f as I,i as V}from"./chunk-YOK3FZP7.js";import{j as P,k as O,l as E,p as S,w as T,y as F}from"./chunk-5NG36BUG.js";import{Eb as d,Gb as x,La as w,Mb as M,Pa as r,Ta as y,Ua as _,W as C,Za as k,aa as f,ba as u,cb as p,d as b,kb as l,pb as n,qb as o,rb as a,ub as h,xb as g,yb as m}from"./chunk-4UEPSE2P.js";var U=()=>["/"];function J(i,s){i&1&&(n(0,"span"),d(1,"Email is required"),o())}function $(i,s){i&1&&(n(0,"span"),d(1,"Please enter a valid email"),o())}function K(i,s){if(i&1&&(n(0,"div",31),p(1,J,2,0,"span",14)(2,$,2,0,"span",14),o()),i&2){let e,t,c=m(2);r(),l("ngIf",(e=c.emailForm.get("email"))==null||e.errors==null?null:e.errors.required),r(),l("ngIf",(t=c.emailForm.get("email"))==null||t.errors==null?null:t.errors.email)}}function Q(i,s){if(i&1){let e=h();n(0,"div",15)(1,"form",16),g("ngSubmit",function(){f(e);let c=m();return u(c.goToNextStep())}),n(2,"div",17)(3,"label",18),a(4,"i",19),d(5," Email address"),o(),a(6,"input",20),p(7,K,3,2,"div",21),o(),n(8,"button",22),d(9," Next "),a(10,"i",23),o()(),n(11,"div",24)(12,"p",25)(13,"span"),d(14,"Or continue with"),o()(),n(15,"div",26)(16,"button",27),g("click",function(){f(e);let c=m();return u(c.loginWithGoogle())}),a(17,"i",28),d(18," \xA0 Google "),o(),n(19,"button",29),g("click",function(){f(e);let c=m();return u(c.loginWithFacebook())}),a(20,"i",30),d(21," \xA0Facebook "),o()()()()}if(i&2){let e,t=m();r(),l("formGroup",t.emailForm),r(6),l("ngIf",((e=t.emailForm.get("email"))==null?null:e.invalid)&&((e=t.emailForm.get("email"))==null?null:e.touched)),r(),l("disabled",t.emailForm.invalid),r(8),l("disabled",t.isLoading),r(3),l("disabled",t.isLoading)}}function X(i,s){i&1&&(n(0,"span"),d(1,"Password is required"),o())}function Z(i,s){if(i&1&&(n(0,"div",31),p(1,X,2,0,"span",14),o()),i&2){let e,t=m(2);r(),l("ngIf",(e=t.passwordForm.get("password"))==null||e.errors==null?null:e.errors.required)}}function ee(i,s){if(i&1&&(n(0,"li"),a(1,"i",48),d(2),o()),i&2){let e=s.$implicit;r(2),x(" ",e," ")}}function te(i,s){if(i&1&&(n(0,"div",45)(1,"ul",46),p(2,ee,3,1,"li",47),o()()),i&2){let e=m(2);r(2),l("ngForOf",e.errors)}}function ie(i,s){i&1&&(n(0,"div",49),a(1,"div",50),o())}function ne(i,s){i&1&&a(0,"i",51)}function oe(i,s){if(i&1){let e=h();n(0,"button",52),g("click",function(){f(e);let c=m(2);return u(c.navigateToResendEmailVerification())}),a(1,"i",42),d(2," Go to Resend Email Verification "),o()}}function re(i,s){if(i&1){let e=h();n(0,"div",15)(1,"form",16),g("ngSubmit",function(){f(e);let c=m();return u(c.login())}),n(2,"div",17)(3,"label",32),a(4,"i",33),d(5," Password"),o(),n(6,"div",34),a(7,"input",35),n(8,"button",36),g("click",function(){f(e);let c=m();return u(c.togglePasswordVisibility())}),a(9,"i",37),o()(),p(10,Z,2,1,"div",21),o(),p(11,te,3,1,"div",38),n(12,"button",22),p(13,ie,2,0,"div",39)(14,ne,1,0,"i",40),d(15),o(),a(16,"hr"),n(17,"button",41),g("click",function(){f(e);let c=m();return u(c.goToBack())}),a(18,"i",42),d(19," Back "),o(),a(20,"br")(21,"br")(22,"div",43),p(23,oe,3,0,"button",44),o()()}if(i&2){let e,t=m();r(),l("formGroup",t.passwordForm),r(6),l("type",t.passwordVisible?"text":"password"),r(2),l("ngClass",t.passwordVisible?"fa-eye-slash":"fa-eye"),r(),l("ngIf",((e=t.passwordForm.get("password"))==null?null:e.invalid)&&((e=t.passwordForm.get("password"))==null?null:e.touched)),r(),l("ngIf",t.errors.length>0),r(),l("disabled",t.passwordForm.invalid||t.isAuthenticating),r(),l("ngIf",t.isAuthenticating),r(),l("ngIf",!t.isAuthenticating),r(),x(" ",t.isAuthenticating?"Logging in...":"Login"," "),r(8),l("ngIf",t.btnGoToResendEmailVerification)}}function ae(i,s){i&1&&a(0,"app-magic-crystal")}var H=class i{constructor(s,e,t,c,le){this.fb=s;this.router=e;this.http=t;this.authService=c;this.renderer=le;this.emailForm=this.fb.group({email:["",[v.required,v.email]]}),this.passwordForm=this.fb.group({password:["",[v.required]]})}emailForm;passwordForm;errors=[];currentStep=1;btnGoToResendEmailVerification=!1;userEmail="";passwordVisible=!1;googleAuth=C(W);isLoading=!1;errorMessage="";isAuthenticating=!1;ngOnInit(){}goToNextStep(){this.emailForm.valid?(this.userEmail=this.emailForm.get("email")?.value,this.currentStep=2):this.emailForm.markAllAsTouched()}goToBack(){this.currentStep=1}login(){if(this.errors=[],this.btnGoToResendEmailVerification=!1,this.isAuthenticating=!0,this.passwordForm.valid&&this.userEmail){let s={email:this.userEmail,password:this.passwordForm.get("password")?.value};this.authService.login(s).subscribe({next:e=>{this.btnGoToResendEmailVerification=!1,this.authService.setEmail(this.userEmail),this.router.navigate(["/dashboard"])},error:e=>{this.isAuthenticating=!1,e.error?.error==="EMAIL_NOT_VERIFIED"?(this.btnGoToResendEmailVerification=!0,this.errors.push("Your email is not verified. Please verify it or resend verification email.")):(this.btnGoToResendEmailVerification=!1,this.errors.push(e.error?.message||"Login failed"))},complete:()=>{this.isAuthenticating=!1}})}else this.btnGoToResendEmailVerification=!1,this.isAuthenticating=!1,this.userEmail||alert("Email is required"),this.passwordForm.markAllAsTouched()}navigateToResendEmailVerification(){this.router.navigate(["/resend-email-verification"],{queryParams:{email:this.userEmail}})}loginWithGoogle(){return b(this,null,function*(){this.isLoading=!0,this.errorMessage="";try{let s=yield this.googleAuth.signInWithGoogle();this.router.navigate(["/dashboard"])}catch{this.errorMessage="Error al iniciar sesi\xF3n con Google",this.isLoading=!1}finally{this.isLoading=!1}})}loginWithFacebook(){return b(this,null,function*(){this.isLoading=!0,this.errorMessage="";try{let s=yield this.googleAuth.signInWithFacebook();this.router.navigate(["/dashboard"])}catch{this.errorMessage="Error al iniciar sesi\xF3n con Facebook",this.isLoading=!1}finally{this.isLoading=!1}})}navigateToForgotPassword(){this.router.navigate(["/forgot-password"])}navigateToRegister(){this.router.navigate(["/register"])}togglePasswordVisibility(){this.passwordVisible=!this.passwordVisible}static \u0275fac=function(e){return new(e||i)(_(B),_(L),_(F),_(A),_(y))};static \u0275cmp=k({type:i,selectors:[["app-login"]],decls:23,vars:5,consts:[[1,"auth-container"],["rel","preconnect","href",w`https://assets.l2terra.online`],[1,"logo-container"],["ngSrc","https://assets.l2terra.online/logoJuanLineage_baja_enBlanco.webp","fill","","alt","Logo de Terra","priority",""],[1,"auth-card"],[1,"auth-title"],[1,"fa-solid","fa-user"],["class","form-step",4,"ngIf"],[1,"auth-links"],[1,"auth-link",3,"click"],[1,"fas","fa-question-circle"],[1,"fas","fa-user-plus"],[1,"btn-secondary",3,"routerLink"],[1,"fa-solid","fa-globe"],[4,"ngIf"],[1,"form-step"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","email"],[1,"fas","fa-envelope"],["type","email","id","email","formControlName","email","placeholder"," Enter your email",1,"form-control"],["class","error-message",4,"ngIf"],["type","submit",1,"btn-primary",3,"disabled"],[1,"fas","fa-arrow-right"],[1,"social-login"],[1,"divider"],[1,"social-buttons"],["type","button",1,"btn-social","google",3,"click","disabled"],[1,"fab","fa-google","social-icon"],["type","button",1,"btn-social","facebook",3,"click","disabled"],[1,"fab","fa-facebook-f","social-icon"],[1,"error-message"],["for","password"],[1,"fas","fa-lock"],[1,"password-input-container"],["id","password","formControlName","password","placeholder","Enter your password",1,"form-control",3,"type"],["type","button",1,"password-toggle",3,"click"],[1,"fas",3,"ngClass"],["class","alert alert-danger","role","alert",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","fas fa-sign-in-alt",4,"ngIf"],[1,"btn-secondary",3,"click"],[1,"fas","fa-arrow-left"],["data-sitekey","0x4AAAAAABhBLTkGwYdbEAbo",1,"cf-turnstile"],["ngClass","btn-secondary",3,"click",4,"ngIf"],["role","alert",1,"alert","alert-danger"],[1,"mb-0",2,"list-style","none","padding","0"],[4,"ngFor","ngForOf"],[1,"fa-solid","fa-triangle-exclamation","text-danger"],[1,"loading-container"],[1,"loading-bar"],[1,"fas","fa-sign-in-alt"],["ngClass","btn-secondary",3,"click"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div"),a(2,"link",1),n(3,"div",2),a(4,"img",3),o()(),n(5,"div",4)(6,"h2",5),a(7,"i",6),d(8," Sign In to Your Account "),o(),p(9,Q,22,5,"div",7)(10,re,24,10,"div",7),n(11,"div",8)(12,"a",9),g("click",function(){return t.navigateToForgotPassword()}),a(13,"i",10),d(14," Forgot password? "),o(),n(15,"a",9),g("click",function(){return t.navigateToRegister()}),a(16,"i",11),d(17," Create an account "),o()(),a(18,"hr"),n(19,"button",12),a(20,"i",13),d(21," Go to website "),o()(),p(22,ae,1,0,"app-magic-crystal",14),o()),e&2&&(r(9),l("ngIf",t.currentStep===1),r(),l("ngIf",t.currentStep===2),r(9),l("routerLink",M(4,U)),r(3),l("ngIf",t.isLoading))},dependencies:[S,P,O,E,D,z,G,R,N,j,q,T,V,I,Y],styles:['.auth-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;padding:20px;background:linear-gradient(to bottom,#0c0f20,#000);font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;box-sizing:border-box;position:relative}.auth-container.dark-mode[_ngcontent-%COMP%]{background:linear-gradient(to bottom,#121212,#000);color:#ddd}.logo-container[_ngcontent-%COMP%]{position:relative;width:350px;height:237px}.logo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:230px}.auth-card[_ngcontent-%COMP%]{background-color:#11111165;border-radius:12px;padding:30px;width:100%;max-width:400px;border:1px solid rgba(255,255,255,.1);position:relative;z-index:1}.auth-container.dark-mode[_ngcontent-%COMP%]   .auth-card[_ngcontent-%COMP%]{background-color:#1e1e1eb3;border-color:#555}.auth-title[_ngcontent-%COMP%]{color:#f9f9f9;text-align:center;margin-bottom:30px;font-weight:600;font-size:24px}.auth-container.dark-mode[_ngcontent-%COMP%]   .auth-title[_ngcontent-%COMP%]{color:#ccc}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;color:#e0e0e0;font-size:14px}.auth-container.dark-mode[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#ccc}.form-control[_ngcontent-%COMP%]{width:100%;height:50px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background-color:#ffffff12;color:#fff;font-size:16px;transition:all .3s ease;padding:0 12px}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#dabe64;box-shadow:0 0 0 2px #dabe6440}.form-control[_ngcontent-%COMP%]::placeholder{color:#fff6}.auth-container.dark-mode[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background-color:#3232324d;color:#eee;border-color:#666}.social-login[_ngcontent-%COMP%]{margin-top:24px}.divider[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center;color:#ffffff80;font-size:14px;margin:20px 0}.divider[_ngcontent-%COMP%]:before, .divider[_ngcontent-%COMP%]:after{content:"";flex:1;border-bottom:1px solid rgba(255,255,255,.2)}.divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:0 10px}.social-buttons[_ngcontent-%COMP%]{display:flex;gap:12px}.btn-social[_ngcontent-%COMP%]{flex:1;padding:10px;border:1px solid rgba(255,255,255,.2);border-radius:8px;background-color:#ffffff12;color:#fff;font-size:14px;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center}.btn-social[_ngcontent-%COMP%]:hover{background-color:#ffffff1f}.google[_ngcontent-%COMP%]{color:#db4437}.facebook[_ngcontent-%COMP%]{color:#4267b2}.auth-links[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:24px;flex-wrap:wrap}.auth-link[_ngcontent-%COMP%], .terms-link[_ngcontent-%COMP%]{color:#dabe64;text-decoration:none;font-size:14px;cursor:pointer;transition:all .3s ease}.auth-link[_ngcontent-%COMP%]:hover, .terms-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.error-message[_ngcontent-%COMP%]{color:#ff6b6b;font-size:12px;margin-top:5px}.form-step[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.password-input-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.password-toggle[_ngcontent-%COMP%]{position:absolute;right:10px;background:transparent;border:none;color:#fff;cursor:pointer;font-size:18px}@media (max-width: 480px){.auth-card[_ngcontent-%COMP%]{padding:20px}.form-control[_ngcontent-%COMP%]{padding:10px}.social-buttons[_ngcontent-%COMP%]{flex-direction:column}.auth-links[_ngcontent-%COMP%]{flex-direction:column;align-items:center;gap:10px}}.loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#0009;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);display:flex;justify-content:center;align-items:center;z-index:9999}.spinner[_ngcontent-%COMP%]{border:6px solid rgba(255,255,255,.2);border-top:6px solid #dabe64;border-radius:50%;width:60px;height:60px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}']})};export{H as LoginComponent};
