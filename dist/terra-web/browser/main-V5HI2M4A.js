import{b as tt,d as it,g as nt,u as ot}from"./chunk-7H4FOIUQ.js";import{a as te}from"./chunk-ONBG2WQO.js";import{a as ee}from"./chunk-BVLKKP7E.js";import{a as Ve,b as qe,d as Ze,e as U,h as et,i as fe}from"./chunk-FETJZTIA.js";import{A as he,B as Xe,C as Ke,D as Je,E as Qe,j as Ge,k as $e,l as G,q as Ue,s as $}from"./chunk-K3SCHVK6.js";import{$a as He,B as we,Bb as T,C as z,Cb as F,Db as L,F as Z,Fb as y,G as Pe,Gb as Fe,Hb as Le,Ja as Oe,Jb as Re,Ka as Ee,Kb as Be,Lb as je,M as pe,N as J,O as Ae,Oa as me,Pa as ge,Pb as ue,Qa as p,Qb as We,R as b,S as Me,Sb as Ne,Va as D,Vb as ze,W as h,X as x,Xb as Ye,_a as E,a as j,aa as Ie,ba as w,ca as P,d as l,db as O,ia as De,j as Ce,k as v,kb as Te,lb as m,nb as Y,o as ce,p as W,qb as d,rb as c,s as ke,sb as f,t as xe,vb as H,yb as A,zb as N}from"./chunk-JKD7CX52.js";var at=(n,e)=>{let t=x(te),i=x(U);return console.log("\u{1F50D} [GUARD] authGuard ejecutado para ruta:",e.url),console.log("\u{1F50D} [GUARD] Estado local de autenticaci\xF3n:",t.isAuthenticated),t.isAuthenticated?(console.log("\u{1F50D} [GUARD] Ya autenticado localmente, permitiendo acceso"),ce(!0)):(console.log("\u{1F50D} [GUARD] No autenticado localmente, verificando con servidor"),t.isLoggedIn().pipe(Z(1),Ae(o=>{console.log("\u{1F50D} [GUARD] Resultado de isLoggedIn:",o),o?console.log("\u{1F50D} [GUARD] Autenticado, permitiendo acceso"):(console.log("\u{1F50D} [GUARD] No autenticado, redirigiendo a login"),i.navigate(["/login"]))}),xe(o=>o),z(o=>(console.error("\u{1F50D} [GUARD] Error en guard:",o),i.navigate(["/login"]),ce(!1)))))};var be=[{path:"",loadComponent:()=>import("./chunk-454H7THV.js").then(n=>n.WebsiteComponent),children:[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",loadComponent:()=>import("./chunk-AWNPTSXU.js").then(n=>n.HomeComponent)},{path:"gallery",loadComponent:()=>import("./chunk-WJLKVAEV.js").then(n=>n.GalleryComponent)},{path:"downloads",loadComponent:()=>import("./chunk-JU66VLVH.js").then(n=>n.DownloadComponent)}]},{path:"login",loadComponent:()=>import("./chunk-LYMUK2FZ.js").then(n=>n.LoginComponent)},{path:"register",loadComponent:()=>import("./chunk-SFAAJCNE.js").then(n=>n.RegisterComponent)},{path:"reset-password",loadComponent:()=>import("./chunk-VPDCVCYQ.js").then(n=>n.ResetPasswordComponent)},{path:"forgot-password",loadComponent:()=>import("./chunk-PL2RUQME.js").then(n=>n.ForgotPasswordComponent)},{path:"resend-email-verification",loadComponent:()=>import("./chunk-XADV2WM3.js").then(n=>n.ResendEmailVerificationComponent)},{path:"verify-email",loadComponent:()=>import("./chunk-YW7AIR6N.js").then(n=>n.VerifyEmailComponent)},{path:"two-factor-step",loadComponent:()=>import("./chunk-ZA52XCC7.js").then(n=>n.TwoFactorComponent)},{path:"dashboard",loadComponent:()=>import("./chunk-LIDYDYQ5.js").then(n=>n.Dashboard2Component),canActivate:[at],children:[{path:"",pathMatch:"full",redirectTo:"home-dashboard"},{path:"home-dashboard",loadComponent:()=>import("./chunk-V7RH7FMI.js").then(n=>n.DashboardHomeComponent)},{path:"create-account-game",loadComponent:()=>import("./chunk-SABMZSNT.js").then(n=>n.CreateAccountGameComponent)},{path:"change-password-game",loadComponent:()=>import("./chunk-VCYMTZQF.js").then(n=>n.ChangePasswordGameComponent)},{path:"buy-terra-coin",loadComponent:()=>import("./chunk-PHDHG4Q3.js").then(n=>n.BuyTerraCoinComponent)},{path:"send-terra-coin",loadComponent:()=>import("./chunk-TZF32A6E.js").then(n=>n.SendTerraCoinComponent)},{path:"support",loadComponent:()=>import("./chunk-3FIX5DG7.js").then(n=>n.SupportComponent)},{path:"offline-market",loadComponent:()=>import("./chunk-LTI73DUP.js").then(n=>n.OfflineMarketComponent)},{path:"setting-account-master",loadComponent:()=>import("./chunk-BOO6Q72T.js").then(n=>n.SettingsAccountMasterComponent)}]},{path:"**",loadComponent:()=>import("./chunk-XSV2V5FQ.js").then(n=>n.WebsiteNotFoundComponent)}],rt=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=He({type:n});static \u0275inj=Me({imports:[fe.forRoot(be),fe]})};var st=(n,e)=>{let t=x(U),i=x(te),o=localStorage.getItem("deviceId")||"",r=n.url.includes("n8n.l2terra.online"),s=n.url.includes("/api/auth/me"),u=n.url.includes("/api/auth/request-2fa-code")||n.url.includes("/api/auth/verify-2fa-code"),k=n.url.includes("/api/auth/refresh"),de=n.url.includes("/api/auth/login")||n.url.includes("/api/auth/register")||n.url.includes("/api/auth/resend-reset-email")||n.url.includes("/api/auth/reset-password")||n.url.includes("/api/auth/verify-email")||n.url.includes("/api/auth/resend-verification")||n.url.includes("/api/auth/google/login")||n.url.includes("/api/auth/request-2fa-code")||n.url.includes("/api/auth/verify-2fa-code")||n.url.includes("/api/kick/channels")||n.url.includes("/api/game/ranking/top-pvp")||n.url.includes("/api/game/ranking/top-pk"),K=n.headers;r||(K=K.set("X-Device-Id",o));let q=n.clone({withCredentials:!r,headers:K});return e(q).pipe(z(_=>{if(s&&(_.status===401||_.status===403)){let I=new Error;return I.name="SilentAuthError",I.message=_.message,Object.defineProperty(I,"status",{value:_.status,writable:!1}),Object.defineProperty(I,"error",{value:_.error,writable:!1}),W(()=>I)}if(_.status===401){let I=_.error?.code;if(I==="TOKEN_EXPIRED")return ve(n,e,i,t);if(I==="2FA_REQUIRED_UNTRUSTED_DEVICE")return W(()=>_);if(I==="REFRESH_TOKEN_EXPIRED")return i.logout().subscribe(()=>{t.navigate(["/login"])}),W(()=>_);if(!k&&!u)return ve(n,e,i,t)}return _.status===403&&!k&&!u?ve(n,e,i,t):W(()=>_)}))};function ve(n,e,t,i){return console.log("\u{1F504} [REFRESH] Iniciando refresh para:",n.url),t.isRefreshingToken?(console.log("\u{1F504} [REFRESH] Ya est\xE1 refrescando, esperando..."),t.refreshTokenSubject$.pipe(we(o=>o!==null),Z(1),pe(()=>{console.log("\u{1F504} [REFRESH] Reintentando request despu\xE9s del refresh:",n.url);let o=localStorage.getItem("deviceId")||"",r=n.headers;n.url.includes("n8n.l2terra.online")||(r=r.set("X-Device-Id",o));let s=n.clone({withCredentials:!n.url.includes("n8n.l2terra.online"),headers:r});return e(s)}),z(o=>(console.error("\u{1F504} [REFRESH] Error en reintento:",o.status,o.message),W(()=>o))))):(console.log("\u{1F504} [REFRESH] Iniciando nuevo refresh"),t.refreshToken().pipe(pe(o=>{console.log("\u{1F504} [REFRESH] Refresh exitoso, reintentando:",n.url);let r=localStorage.getItem("deviceId")||"",s=n.headers;n.url.includes("n8n.l2terra.online")||(s=s.set("X-Device-Id",r));let u=n.clone({withCredentials:!n.url.includes("n8n.l2terra.online"),headers:s});return e(u)}),z(o=>(console.error("\u{1F504} [REFRESH] Error en refresh:",o.status,o.message),(o.status===401||o.status===403)&&t.logout().subscribe(()=>{i.navigate(["/login"])}),W(()=>o))),Pe(()=>{console.log("\u{1F504} [REFRESH] Proceso de refresh finalizado")})))}var lt={providers:[ze({eventCoalescing:!0}),et(be),Ke(Qe(),Je([st]))]};var ie=class n{constructor(e){this.http=e}WEBHOOK_URL=ee.WEBHOOK_URL_N8N;AUTH_USERNAME=ee.AUTH_USERNAME_N8N;AUTH_PASSWORD=ee.AUTH_PASSWORD_N8N;sendMessageAsync(e){return l(this,null,function*(){let t={sessionId:"asdasdsa",message:e,timestamp:new Date().toISOString(),action:"sendMessage"},i=new he({"Content-Type":"application/json",Authorization:"Basic "+btoa(`${this.AUTH_USERNAME}:${this.AUTH_PASSWORD}`)});try{return yield ke(this.http.post(this.WEBHOOK_URL,t,{headers:i,withCredentials:!1}))}catch(o){throw console.error("Error al enviar mensaje:",o),o}})}sendMessage(e){let t={sessionId:"asdasdsa",message:e,timestamp:new Date().toISOString(),action:"sendMessage"},i=new he({"Content-Type":"application/json",Authorization:"Basic "+btoa(`${this.AUTH_USERNAME}:${this.AUTH_PASSWORD}`)});return this.http.post(this.WEBHOOK_URL,t,{headers:i,withCredentials:!1})}static \u0275fac=function(t){return new(t||n)(h(Xe))};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};var mt=["messagesContainer"],gt=["messageInput"],ut=(n,e)=>({"user-wrapper":n,"bot-wrapper":e}),ht=(n,e)=>({"user-message":n,"bot-message":e});function ft(n,e){n&1&&(d(0,"div",13)(1,"h3"),y(2,"Hello! \u{1F44B}"),c(),d(3,"p"),y(4,"How can I help you today?"),c()())}function bt(n,e){if(n&1&&(d(0,"div",14)(1,"div",15)(2,"div",16),f(3,"div",17),d(4,"div",18),y(5),We(6,"date"),c()()()()),n&2){let t=e.$implicit;m("ngClass",ue(7,ut,t.sender==="user",t.sender==="bot")),p(),m("ngClass",ue(10,ht,t.sender==="user",t.sender==="bot")),p(2),m("innerHTML",t.text,Oe),p(2),Fe(Ne(6,4,t.timestamp,"shortTime"))}}function vt(n,e){n&1&&(d(0,"div",19)(1,"div",20)(2,"div",21),f(3,"span")(4,"span")(5,"span"),c(),d(6,"span",22),y(7,"Typing..."),c()()())}function yt(n,e){n&1&&(d(0,"span",23),f(1,"i",24),c())}function St(n,e){n&1&&(d(0,"span",25),f(1,"i",26),c())}var ne=class n{messagesContainer;messageInput;msg="";messages=[];isLoading=!1;shouldScrollToBottom=!1;chatbotService=x(ie);cdRef=x(Ye);sanitizer=x(qe);ngAfterViewChecked(){this.shouldScrollToBottom&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}sendMessage(){return l(this,null,function*(){let e=this.msg.trim();if(!(!e||this.isLoading)){this.addMessage(e,"user"),this.msg="",this.isLoading=!0,this.shouldScrollToBottom=!0,setTimeout(()=>{this.messageInput?.nativeElement?.focus()},100);try{let t=yield this.chatbotService.sendMessageAsync(e),i=this.extractBotResponse(t);this.addMessage(i,"bot")}catch(t){this.addMessage("Error al conectar con el servicio","bot"),console.error("Error:",t)}finally{this.isLoading=!1,this.shouldScrollToBottom=!0,this.forceViewUpdate()}}})}onKeyPress(e){e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),this.sendMessage())}addMessage(e,t){let i=t==="bot"?this.sanitizer.bypassSecurityTrustHtml(e.replace(/\n/g,"<br>")):e;this.messages=[...this.messages,{text:i,sender:t,timestamp:new Date}],this.shouldScrollToBottom=!0,this.cdRef.detectChanges()}extractBotResponse(e){return e?.output||e?.reply||e?.message||e?.data?.message||e?.result||JSON.stringify(e)||"Recib\xED tu mensaje"}forceViewUpdate(){this.cdRef.detectChanges()}scrollToBottom(){if(this.messagesContainer?.nativeElement){let e=this.messagesContainer.nativeElement;e.scrollTop=e.scrollHeight}}trackByMessage(e,t){return e}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=E({type:n,selectors:[["app-botterra"]],viewQuery:function(t,i){if(t&1&&(T(mt,5),T(gt,5)),t&2){let o;F(o=L())&&(i.messagesContainer=o.first),F(o=L())&&(i.messageInput=o.first)}},decls:13,vars:11,consts:[["messagesContainer",""],["messageInput",""],[1,"chatbot-container"],[1,"messages-container"],["class","welcome-message",4,"ngIf"],["class","message-wrapper",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],["class","loading-wrapper",4,"ngIf"],[1,"input-container"],[1,"input-wrapper"],["placeholder","Type your message...","name","message","autocomplete","off",1,"message-input",3,"ngModelChange","keypress","ngModel","disabled"],[1,"send-button",3,"click","disabled"],["class","send-icon",4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"welcome-message"],[1,"message-wrapper",3,"ngClass"],[1,"message",3,"ngClass"],[1,"message-content"],[1,"message-text",3,"innerHTML"],[1,"message-time"],[1,"loading-wrapper"],[1,"loading-message"],[1,"typing-indicator"],[1,"typing-text"],[1,"send-icon"],[1,"fa-solid","fa-paper-plane"],[1,"loading-spinner"],[1,"fa-solid","fa-circle-notch","fa-spin"]],template:function(t,i){if(t&1){let o=H();d(0,"div",2)(1,"div",3,0),O(3,ft,5,0,"div",4)(4,bt,7,13,"div",5)(5,vt,8,0,"div",6),c(),d(6,"div",7)(7,"div",8)(8,"input",9,1),je("ngModelChange",function(s){return w(o),Be(i.msg,s)||(i.msg=s),P(s)}),A("keypress",function(s){return w(o),P(i.onKeyPress(s))}),c(),d(10,"button",10),A("click",function(){return w(o),P(i.sendMessage())}),O(11,yt,2,0,"span",11)(12,St,2,0,"span",12),c()()()()}t&2&&(p(3),m("ngIf",i.messages.length===0),p(),m("ngForOf",i.messages)("ngForTrackBy",i.trackByMessage),p(),m("ngIf",i.isLoading),p(3),Re("ngModel",i.msg),m("disabled",i.isLoading),p(2),Y("loading",i.isLoading),m("disabled",!i.msg.trim()||i.isLoading),p(),m("ngIf",!i.isLoading),p(),m("ngIf",i.isLoading))},dependencies:[$,Ge,$e,G,Ue,ot,tt,it,nt],styles:['.chatbot-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background:linear-gradient(to bottom,#0c0f20,#000);border-radius:16px;overflow:hidden;box-shadow:0 20px 40px #0000004d;position:relative}.chatbot-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,#dabe64,transparent)}.messages-container[_ngcontent-%COMP%]{flex:1;padding:24px;overflow-y:auto;display:flex;flex-direction:column;gap:16px;scroll-behavior:smooth}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#0000001a;border-radius:3px}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:linear-gradient(to bottom,#746535,#dabe64);border-radius:3px}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:linear-gradient(to bottom,#dabe64,#746535)}.welcome-message[_ngcontent-%COMP%]{text-align:center;padding:32px 20px;background:linear-gradient(135deg,#dabe641a,#7465351a);border:1px solid rgba(218,190,100,.3);border-radius:16px;margin-bottom:16px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.welcome-icon[_ngcontent-%COMP%]{margin-bottom:16px}.welcome-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2.5rem;color:#dabe64;filter:drop-shadow(0 0 10px rgba(218,190,100,.5))}.welcome-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#dabe64;margin:0 0 8px;font-size:1.5rem;font-weight:600}.welcome-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#dabe64cc;margin:0;font-size:1rem}.message-wrapper[_ngcontent-%COMP%]{display:flex;animation:_ngcontent-%COMP%_slideIn .4s ease-out}.user-wrapper[_ngcontent-%COMP%]{justify-content:flex-end}.bot-wrapper[_ngcontent-%COMP%]{justify-content:flex-start}.message[_ngcontent-%COMP%]{max-width:75%;padding:16px 20px;border-radius:20px;position:relative;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);transition:all .3s ease}.message[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 20px #0000004d}.bot-message[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1119,#1e1e1e99);color:#dabe64;border:1px solid rgba(218,190,100,.3);border-bottom-left-radius:6px;position:relative}.bot-message[_ngcontent-%COMP%]:before{content:"";position:absolute;left:-8px;bottom:0;width:0;height:0;border-style:solid;border-width:0 8px 12px 0;border-color:transparent rgba(218,190,100,.3) transparent transparent}.user-message[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dabe6426,#74653526);color:#dabe64;border:1px solid rgba(218,190,100,.4);border-bottom-right-radius:6px;position:relative}.user-message[_ngcontent-%COMP%]:before{content:"";position:absolute;right:-8px;bottom:0;width:0;height:0;border-style:solid;border-width:0 0 12px 8px;border-color:transparent transparent rgba(218,190,100,.4) transparent}.message-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}.message-text[_ngcontent-%COMP%]{line-height:1.5;word-wrap:break-word}.message-time[_ngcontent-%COMP%]{font-size:.7rem;opacity:.6;margin-top:8px;align-self:flex-end;color:#dabe64b3}.loading-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;animation:_ngcontent-%COMP%_slideIn .4s ease-out}.loading-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px 20px;background:linear-gradient(135deg,#1119,#1e1e1e99);border:1px solid rgba(218,190,100,.3);border-radius:20px 20px 20px 6px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.typing-indicator[_ngcontent-%COMP%]{display:flex;gap:4px}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:8px;height:8px;background:linear-gradient(45deg,#746535,#dabe64);border-radius:50%;animation:_ngcontent-%COMP%_typing 1.4s infinite ease-in-out}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}.typing-text[_ngcontent-%COMP%]{color:#dabe64cc;font-size:.9rem;font-style:italic}.input-container[_ngcontent-%COMP%]{padding:20px;background:linear-gradient(135deg,#0000004d,#1a1f2e4d);border-top:1px solid rgba(218,190,100,.2);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.input-wrapper[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.message-input[_ngcontent-%COMP%]{flex:1;padding:14px 20px;border:2px solid rgba(218,190,100,.3);border-radius:25px;outline:none;font-size:15px;background:#0000004d;color:#dabe64;transition:all .3s ease;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.message-input[_ngcontent-%COMP%]::placeholder{color:#dabe6480}.message-input[_ngcontent-%COMP%]:focus{border-color:#dabe64;box-shadow:0 0 0 3px #dabe6433;background:#0006}.send-button[_ngcontent-%COMP%]{width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,#746535,#dabe64);color:#fff;border:none;display:flex;align-items:center;justify-content:center;transition:all .3s ease;cursor:pointer;position:relative;overflow:hidden}.send-button[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,#dabe64,#746535);opacity:0;transition:opacity .3s ease}.send-button[_ngcontent-%COMP%]:hover:not(:disabled):before{opacity:1}.send-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 20px #dabe644d}.send-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;transform:none}.send-icon[_ngcontent-%COMP%], .loading-spinner[_ngcontent-%COMP%]{position:relative;z-index:2;font-size:1.1rem}.send-button.loading[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1s infinite}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_typing{0%,60%,to{transform:translateY(0);opacity:.5}30%{transform:translateY(-8px);opacity:1}}@keyframes _ngcontent-%COMP%_pulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}@media (max-width: 768px){.chatbot-container[_ngcontent-%COMP%]{border-radius:12px}.messages-container[_ngcontent-%COMP%]{padding:16px}.message[_ngcontent-%COMP%]{max-width:85%;padding:12px 16px}.input-container[_ngcontent-%COMP%]{padding:16px}.message-input[_ngcontent-%COMP%]{padding:12px 16px;font-size:14px}.send-button[_ngcontent-%COMP%]{width:46px;height:46px}}']})};var a={assetBasePath:"https://assets.l2terra.online/sprites/Skeleton_Crusader_3/PNG/PNG%20Sequences/",defaultFrameRate:12,enableProgressiveLoading:!0,enableLazyLoading:!0,loadingBatchSize:3,loadingDelay:50,movementSpeed:2,gravity:3,maxFallSpeed:3,jumpPower:7,dragHoldMs:150,dragThreshold:5,minAutoWalkDistance:80,dialogDuration:3e3,dialogFadeTime:500,selectionGlowColor:"#FFD700",selectionGlowIntensity:15,dragScale:1.1,dragShadow:"0 10px 20px rgba(0, 0, 0, 0.4)",initialX:350,initialY:0,spriteWidth:100,spriteHeight:100,enableAutoWalk:!0,enableAutoBlink:!0,enableRandomDialog:!0,enableDragAndDrop:!0,enableClick:!0,useSimpleDrag:!0,enableJump:!0,autoWalkInterval:6e3,autoBlinkInterval:4e3,randomDialogInterval:6e3,blinkDuration:900,defaultDialog:"Hello, I'm the Skeleton Crusader!",dialogMessages:["Our Terra server is temporarily on pause.","Development is paused while we focus on studies.","For updates, join our Discord community.","We\u2019ll be back stronger soon!","Thanks for your support!","Nuestro servidor Terra est\xE1 en pausa temporal.","Pausamos el desarrollo por temas de estudio.","Unite a nuestro Discord para m\xE1s novedades.","\xA1Volveremos con todo pronto!","\xA1Gracias por el aguante!"],animations:{dying:{folder:"Dying",frames:15},fallingDown:{folder:"Falling Down",frames:6},hurt:{folder:"Hurt",frames:12},idle:{folder:"Idle",frames:18},idleBlinking:{folder:"Idle Blinking",frames:18},jumpLoop:{folder:"Jump Loop",frames:6},jumpStart:{folder:"Jump Start",frames:6},kicking:{folder:"Kicking",frames:12},runSlashing:{folder:"Run Slashing",frames:12},runThrowing:{folder:"Run Throwing",frames:12},running:{folder:"Running",frames:12},slashing:{folder:"Slashing",frames:12},slashingInTheAir:{folder:"Slashing in The Air",frames:12},sliding:{folder:"Sliding",frames:6},throwing:{folder:"Throwing",frames:12},throwingInTheAir:{folder:"Throwing in The Air",frames:12},walking:{folder:"Walking",frames:24}}},oe={high:["walking","running","jumpStart","jumpLoop","kicking"],medium:["hurt","slashing","throwing","idleBlinking"],low:["dying","fallingDown","runSlashing","runThrowing","slashingInTheAir","sliding","throwingInTheAir"]},M={enableLogs:!1,enablePhysicsLogs:!1,enableAnimationLogs:!1,enableDragLogs:!1,enableDialogLogs:!1,enableLoadingLogs:!1},g={physics:(n,...e)=>{M.enableLogs&&M.enablePhysicsLogs},animation:(n,...e)=>{M.enableLogs&&M.enableAnimationLogs},drag:(n,...e)=>{M.enableLogs&&M.enableDragLogs},dialog:(n,...e)=>{M.enableLogs&&M.enableDialogLogs},loading:(n,...e)=>{M.enableLogs&&M.enableLoadingLogs},error:(n,...e)=>{console.error(`\u274C [ERROR] ${n}`,...e)},warn:(n,...e)=>{console.warn(`\u26A0\uFE0F [WARN] ${n}`,...e)}};var S=class n{_currentAnimation=new v("idle");_characterState=new v("idle");_position=new v({x:a.initialX,y:a.initialY});_physics=new v({velocity:0,jumpVelocity:0,fallSpeed:0,isJumping:!1,isFalling:!1,groundY:0});_dragState=new v({isDragging:!1,isMouseDown:!1,mouseDownTime:0,startMouseX:0,startMouseY:0,startElementX:0,startElementY:0,dragOffsetX:0,dragOffsetY:0,dragDistance:0,selecting:!1,clickFired:!1,selectionEffect:!1});_facingLeft=new v(!1);_currentFrame=new v(0);_dialog=new v("");currentAnimation$=this._currentAnimation.asObservable();characterState$=this._characterState.asObservable();position$=this._position.asObservable();physics$=this._physics.asObservable();dragState$=this._dragState.asObservable();facingLeft$=this._facingLeft.asObservable();currentFrame$=this._currentFrame.asObservable();dialog$=this._dialog.asObservable();_screenWidth=window.innerWidth;_screenHeight=window.innerHeight;_playOnce=!1;_blinkBackToIdle=!1;get currentAnimation(){return this._currentAnimation.value}get characterState(){return this._characterState.value}get position(){return this._position.value}get physics(){return this._physics.value}get dragState(){return this._dragState.value}get facingLeft(){return this._facingLeft.value}get currentFrame(){return this._currentFrame.value}get dialog(){return this._dialog.value}get screenWidth(){return this._screenWidth}get screenHeight(){return this._screenHeight}get playOnce(){return this._playOnce}get blinkBackToIdle(){return this._blinkBackToIdle}setAnimation(e,t=!1){this._currentAnimation.next(e),this._playOnce=t,this.setCurrentFrame(0),e==="idleBlinking"&&t?this._blinkBackToIdle=!0:this._blinkBackToIdle=!1}setCharacterState(e){this._characterState.next(e)}setPosition(e,t){this._position.next({x:e,y:t})}updatePosition(e){let t=this._position.value;this._position.next(j(j({},t),e))}setPhysics(e){let t=this._physics.value;this._physics.next(j(j({},t),e))}setDragState(e){let t=this._dragState.value;this._dragState.next(j(j({},t),e))}setFacingLeft(e){this._facingLeft.next(e)}setCurrentFrame(e){this._currentFrame.next(e)}setDialog(e){this._dialog.next(e)}updateScreenSize(){this._screenWidth=window.innerWidth,this._screenHeight=window.innerHeight}resetDragState(){this.setDragState({isDragging:!1,isMouseDown:!1,selecting:!1,clickFired:!1,selectionEffect:!1,dragDistance:0})}isWithinBounds(e,t){return{x:Math.max(0,Math.min(this._screenWidth-a.spriteWidth,e)),y:Math.max(0,t)}}getDistanceToTarget(e,t){let i=this.position,o=e-i.x,r=t-i.y;return Math.sqrt(o*o+r*r)}shouldFaceLeft(e){return e<this.position.x}canMove(){let e=this.dragState,t=this.physics;return!e.isDragging&&!t.isJumping&&!t.isFalling&&this.characterState!=="dying"}canJump(){let e=this.physics;return!e.isJumping&&!e.isFalling&&this.characterState!=="dying"}canInteract(){return this.characterState!=="dying"&&!this.dragState.isDragging}reset(){this.setAnimation("idle"),this.setCharacterState("idle"),this.setPosition(a.initialX,a.initialY),this.setPhysics({velocity:0,jumpVelocity:0,fallSpeed:0,isJumping:!1,isFalling:!1,groundY:0}),this.resetDragState(),this.setFacingLeft(!1),this.setDialog("")}static \u0275fac=function(t){return new(t||n)};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};var V=class n{_imageCache=new Map;_loadingProgress=new v(0);_isLoading=new v(!1);loadingProgress$=this._loadingProgress.asObservable();isLoading$=this._isLoading.asObservable();constructor(){}get imageCache(){return this._imageCache}get isLoading(){return this._isLoading.value}get loadingProgress(){return this._loadingProgress.value}preloadAnimation(e){return l(this,null,function*(){let t=a.animations[e];if(!t){console.warn(`\u26A0\uFE0F Animaci\xF3n no encontrada: ${e}`);return}let i=[];for(let o=0;o<t.frames;o++){let r=o.toString().padStart(3,"0"),s=this.buildFrameUrl(t.folder,r);this._imageCache.has(s)||i.push(this.loadSingleImage(s))}yield Promise.all(i)})}preloadAllImagesAsync(){return l(this,null,function*(){this._isLoading.next(!0);try{yield this.loadAnimationBatch(oe.high,"alta prioridad"),yield this.loadAnimationBatch(oe.medium,"media prioridad"),yield this.loadAnimationBatch(oe.low,"baja prioridad"),this._loadingProgress.next(100)}catch(e){console.error("\u274C Error en la precarga:",e)}finally{this._isLoading.next(!1)}})}loadAnimationBatch(e,t){return l(this,null,function*(){for(let i of e)yield this.preloadAnimation(i),this.updateProgress(),yield this.delay(a.loadingDelay)})}loadSingleImage(e){return new Promise(t=>{let i=new Image;i.onload=()=>{this._imageCache.set(e,i),t()},i.onerror=()=>{console.warn(`\u26A0\uFE0F Error cargando frame: ${e}`),t()},i.src=e})}loadImageOnDemand(e){if(this._imageCache.has(e))return;let t=new Image;t.onload=()=>{this._imageCache.set(e,t)},t.onerror=()=>{console.warn(`\u26A0\uFE0F Error cargando imagen bajo demanda: ${e}`)},t.src=e}isAnimationLoaded(e){let t=a.animations[e];if(!t)return!1;for(let i=0;i<t.frames;i++){let o=i.toString().padStart(3,"0"),r=this.buildFrameUrl(t.folder,o);if(!this._imageCache.has(r))return!1}return!0}ensureAnimationLoaded(e){this.isAnimationLoaded(e)||this.preloadAnimation(e)}getFrameUrl(e,t){let i=a.animations[e];if(!i)return"";let o=t.toString().padStart(3,"0");return this.buildFrameUrl(i.folder,o)}getFrameImage(e,t){let i=this.getFrameUrl(e,t),o=this._imageCache.get(i);return o?o.src:(this.loadImageOnDemand(i),i)}getLoadingStatus(){let e={};return Object.keys(a.animations).forEach(t=>{e[t]=this.isAnimationLoaded(t)}),e}getCacheStats(){let e=Object.keys(a.animations).length,t=Object.values(this.getLoadingStatus()).filter(i=>i).length;return{totalCached:this._imageCache.size,totalAnimations:e,percentage:Math.round(t/e*100)}}clearImageCache(){this._imageCache.clear(),this._loadingProgress.next(0)}buildFrameUrl(e,t){return`${a.assetBasePath}${e}/0_Skeleton_Crusader_${e}_${t}.png`}updateProgress(){let e=this.getCacheStats();this._loadingProgress.next(e.percentage)}delay(e){return new Promise(t=>setTimeout(t,e))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};var R=class n{constructor(e,t){this.botState=e;this.imagePreloader=t}_animationFrameId;_lastFrameTimestamp=performance.now();_frameRate=a.defaultFrameRate;_isFirstFrame=!0;startAnimation(e){e&&(this._frameRate=e),this._animationFrameId&&cancelAnimationFrame(this._animationFrameId);let t=i=>{let o=1e3/this._frameRate;i-this._lastFrameTimestamp>=o&&(this.updateFrame(),this._lastFrameTimestamp=i),this._animationFrameId=requestAnimationFrame(t)};this._animationFrameId=requestAnimationFrame(t)}stopAnimation(){this._animationFrameId&&(cancelAnimationFrame(this._animationFrameId),this._animationFrameId=null)}updateFrame(){let e=this.botState.currentAnimation,t=a.animations[e];if(!t){this.setAnimation("idle");return}let i=this.botState.currentFrame;if(this._isFirstFrame){this._isFirstFrame=!1;return}let o=(i+1)%t.frames;this.botState.setCurrentFrame(o),this.handleSpecialAnimations(e,o,t.frames)}handleSpecialAnimations(e,t,i){this.botState.blinkBackToIdle&&e==="idleBlinking"&&t===i-1&&this.setAnimation("idle"),this.botState.playOnce&&t===i-1&&this.handleOnceAnimation(e)}handleOnceAnimation(e){switch(e){case"kicking":case"hurt":case"dying":case"throwing":case"slashing":this.setAnimation("idle");break;default:break}}setAnimation(e,t=!1){if(!a.animations[e]){console.warn(`\u26A0\uFE0F Animaci\xF3n no v\xE1lida: ${e}`);return}this.imagePreloader.ensureAnimationLoaded(e),this.botState.setAnimation(e,t),g.animation(`Cambiando a animaci\xF3n: ${e}${t?" (una vez)":""}`)}getCurrentFrameUrl(){let e=this.botState.currentAnimation,t=this.botState.currentFrame;return this.imagePreloader.getFrameImage(e,t)}startBlinkAnimation(){this.botState.characterState==="idle"&&this.botState.currentAnimation==="idle"&&this.setAnimation("idleBlinking",!0)}handleMovementAnimation(e,t){if(!e){(this.botState.currentAnimation==="walking"||this.botState.currentAnimation==="running")&&this.setAnimation("idle");return}let i=t>5?"running":"walking";this.botState.currentAnimation!==i&&this.setAnimation(i)}handleJumpAnimation(e,t){e&&(t<0&&this.botState.currentAnimation!=="jumpStart"?this.setAnimation("jumpStart"):t>0&&this.botState.currentAnimation==="jumpStart"&&this.setAnimation("jumpLoop"))}handleFallAnimation(){this.botState.currentAnimation!=="fallingDown"&&this.setAnimation("fallingDown")}playOnceAnimation(e,t){if(this.setAnimation(e,!0),t){let i=a.animations[e];if(i){let o=i.frames/this._frameRate*1e3;setTimeout(t,o)}}}getAnimationDuration(e){let t=a.animations[e];return t?t.frames/this._frameRate*1e3:0}isAnimationPlaying(e){return this.botState.currentAnimation===e}getCurrentAnimationInfo(){let e=this.botState.currentAnimation,t=this.botState.currentFrame,i=a.animations[e];return{name:e,frame:t,totalFrames:i?.frames||0,progress:i?t/i.frames*100:0}}pauseAnimation(){this._animationFrameId&&(cancelAnimationFrame(this._animationFrameId),this._animationFrameId=null)}resumeAnimation(){this._animationFrameId||this.startAnimation()}cleanup(){this.stopAnimation()}static \u0275fac=function(t){return new(t||n)(h(S),h(V))};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};var B=class n{constructor(e){this.botState=e}_dialogTimeout=null;_randomDialogInterval=null;_dialogMessages=[...a.dialogMessages];startDialogSystem(){this.setDialog(a.defaultDialog,3e3),a.enableRandomDialog&&this.startRandomDialogs()}stopDialogSystem(){this.clearCurrentDialog(),this.stopRandomDialogs()}setDialog(e,t){this.clearDialogTimeout(),this.botState.setDialog(e),g.dialog(`Di\xE1logo: "${e}"`),t&&t>0&&(this._dialogTimeout=setTimeout(()=>{this.fadeOutDialog()},t))}clearCurrentDialog(){this.clearDialogTimeout(),this.botState.setDialog("")}fadeOutDialog(){let e=document.querySelector(".dialog-bubble");e?(e.style.opacity="0",setTimeout(()=>{this.botState.setDialog("")},a.dialogFadeTime)):this.botState.setDialog("")}startRandomDialogs(){this._randomDialogInterval||(this._randomDialogInterval=setInterval(()=>{!this.botState.dialog&&this._dialogMessages.length>0&&this.showRandomDialog()},a.randomDialogInterval))}stopRandomDialogs(){this._randomDialogInterval&&(clearInterval(this._randomDialogInterval),this._randomDialogInterval=null)}showRandomDialog(){if(this._dialogMessages.length===0)return;let e=Math.floor(Math.random()*this._dialogMessages.length),t=this._dialogMessages[e];this.setDialog(t,a.dialogDuration)}clearDialogTimeout(){this._dialogTimeout&&(clearTimeout(this._dialogTimeout),this._dialogTimeout=null)}addDialogMessage(e){e&&!this._dialogMessages.includes(e)&&(this._dialogMessages.push(e),g.dialog(`Mensaje agregado: "${e}"`))}removeDialogMessage(e){let t=this._dialogMessages.indexOf(e);t>-1&&(this._dialogMessages.splice(t,1),g.dialog(`Mensaje removido: "${e}"`))}setDialogMessages(e){if(!Array.isArray(e)){console.warn("\u26A0\uFE0F Los mensajes de di\xE1logo deben ser un array");return}this._dialogMessages=[...e],g.dialog(`Lista de mensajes actualizada (${e.length} mensajes)`)}getDialogMessages(){return[...this._dialogMessages]}handleInteractionDialog(e){let i={click:["Click! Hello!","You clicked me!","Hi there!"],drag:["I'm being dragged!","Wheee!","This is fun!"],hover:["Don't come near","Stay back!","What do you want?"],jump:["Jump!","Here I go!","Flying high!"],fall:["I'm falling!","Oh no!","This is not good!"],hurt:["Ouch! That hurt!","That was painful!","Be more careful!"]}[e];if(i&&i.length>0){let o=i[Math.floor(Math.random()*i.length)],r=e==="hover"||e==="hurt"?2e3:1500;this.setDialog(o,r)}}handleContextualDialog(){let e=this.botState.characterState,t=this.botState.currentAnimation;switch(e){case"idle":Math.random()<.1&&this.setDialog("Just chilling here...",2e3);break;case"moving":Math.random()<.05&&this.setDialog("Let's go for a walk!",1500);break;case"jumping":break;case"falling":break}}showWelcomeDialog(e){let t=e?`Hello ${e}! I'm the Skeleton Crusader!`:a.defaultDialog;this.setDialog(t,4e3)}showGoodbyeDialog(){let e=["See you later!","Goodbye for now!","Until we meet again!","Take care!"],t=e[Math.floor(Math.random()*e.length)];this.setDialog(t,3e3)}getDialogState(){return{currentDialog:this.botState.dialog,hasActiveDialog:!!this.botState.dialog,messageCount:this._dialogMessages.length,isRandomDialogActive:!!this._randomDialogInterval}}pauseRandomDialogs(){this.stopRandomDialogs()}resumeRandomDialogs(){a.enableRandomDialog&&this.startRandomDialogs()}cleanup(){this.clearCurrentDialog(),this.stopRandomDialogs()}static \u0275fac=function(t){return new(t||n)(h(S))};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};var X=class n{constructor(e,t,i){this.botState=e;this.animationHandler=t;this.dialogueHandler=i}_movementIntervalId;_autoWalkInterval;_moveCheckInterval;_autoWalkShouldResume=!1;_targetX=null;_targetY=null;startPhysics(){this.startMovementLoop(),a.enableAutoWalk&&this.startAutoWalk()}stopPhysics(){this._movementIntervalId&&(clearInterval(this._movementIntervalId),this._movementIntervalId=null),this.stopAutoWalk()}updatePhysics(){this.updateJumpPhysics(),this.updateFallPhysics(),this.updateMovement(),this.updatePosition()}updateJumpPhysics(){let e=this.botState.physics;if(!e.isJumping)return;let t=e.jumpVelocity+a.gravity,i=this.botState.position.y+t;this.botState.setPhysics({jumpVelocity:t}),this.botState.updatePosition({y:i}),this.animationHandler.handleJumpAnimation(!0,t),i>=e.groundY&&this.landFromJump()}updateFallPhysics(){let e=this.botState.physics,t=this.botState.dragState;if(!e.isFalling||t.isDragging)return;let i=a.gravity,o=a.maxFallSpeed,r=e.fallSpeed+i;r>o&&(r=o);let s=this.botState.position.y;e.fallSpeed===0&&g.physics(`Iniciando ca\xEDda desde Y=${s}`);let u=s-r;u<e.groundY&&(u=e.groundY),this.botState.updatePosition({y:u}),this.botState.setPhysics({fallSpeed:r}),g.physics(`Ca\xEDda: Y=${u.toFixed(2)}, Speed=${r.toFixed(3)}`),u===e.groundY&&this.landFromFall()}updateMovement(){let e=this.botState.dragState,t=this.botState.physics,i=this.botState.position,o=this.botState.characterState;if(e.isDragging||t.isFalling||o!=="moving"||this._targetX===null||this._targetY===null)return;let r=this._targetX-i.x,s=this._targetY-i.y,u=Math.sqrt(r*r+s*s),k=a.movementSpeed*.5;if(u<k){this.botState.setPosition(this._targetX,this._targetY),this.botState.setCharacterState("idle"),this.animationHandler.setAnimation("idle"),this._targetX=null,this._targetY=null;return}let de=r/u*k,K=s/u*k;this.botState.updatePosition({x:i.x+de,y:i.y+K}),this.botState.setFacingLeft(de<0);let q=this.botState.currentAnimation;q!=="running"&&q!=="walking"&&this.animationHandler.setAnimation("running")}updatePosition(){let e=this.botState.position;if(this.botState.dragState.isDragging)return;let i=this.botState.isWithinBounds(e.x,e.y);(i.x!==e.x||i.y!==e.y)&&this.botState.setPosition(i.x,i.y)}jump(){!this.botState.canJump()||!a.enableJump||(this.botState.setPhysics({isJumping:!0,jumpVelocity:-a.jumpPower}),this.botState.setCharacterState("jumping"),this.animationHandler.setAnimation("jumpStart"),this.dialogueHandler.setDialog("Jump!",1e3),this.pauseAutoWalk())}landFromJump(){let e=this.botState.physics;this.botState.setPosition(this.botState.position.x,e.groundY),this.botState.setPhysics({isJumping:!1,jumpVelocity:0}),this.botState.setCharacterState("idle"),this.animationHandler.setAnimation("idle"),this.dialogueHandler.setDialog("I landed!",1e3),this.resumeAutoWalk()}startFalling(){this.botState.physics.isFalling||(g.physics("Iniciando ca\xEDda"),this.botState.setPhysics({isFalling:!0,fallSpeed:0}),this.botState.setCharacterState("falling"),this.animationHandler.handleFallAnimation(),this.dialogueHandler.setDialog("I'm falling!",1500),this.pauseAutoWalk())}landFromFall(){let e=this.botState.physics;g.physics("Aterrizando desde ca\xEDda"),this.botState.setPosition(this.botState.position.x,e.groundY),this.botState.setPhysics({isFalling:!1,fallSpeed:0}),this.animationHandler.setAnimation("hurt",!0),this.dialogueHandler.setDialog("Ouch! That hurt!",2e3),setTimeout(()=>{this.botState.setCharacterState("idle"),this.animationHandler.setAnimation("idle"),this.resumeAutoWalk()},1e3)}moveTo(e,t=this.botState.physics.groundY){if(!this.botState.canMove())return;let i=this.botState.isWithinBounds(e,t),o=this.botState.shouldFaceLeft(i.x);this.botState.setFacingLeft(o),this._targetX=i.x,this._targetY=i.y,this.botState.setCharacterState("moving"),this.animationHandler.setAnimation("running")}stopMoving(){this.botState.setCharacterState("idle"),this.animationHandler.setAnimation("idle"),this._moveCheckInterval&&(clearInterval(this._moveCheckInterval),this._moveCheckInterval=null),this._targetX=null,this._targetY=null}startMovementLoop(){this._movementIntervalId&&clearInterval(this._movementIntervalId),this._movementIntervalId=setInterval(()=>{this.botState.updateScreenSize(),this.updatePhysics()},16)}startAutoWalk(){this._autoWalkInterval||!a.enableAutoWalk||(this._autoWalkInterval=setInterval(()=>{let e=this.botState.characterState,t=this.botState.dragState,i=this.botState.physics;e==="idle"&&!t.isDragging&&!i.isJumping&&!i.isFalling&&this.performAutoWalk()},a.autoWalkInterval))}performAutoWalk(){let e=this.botState.screenWidth,t=50,i=e-a.spriteWidth-50,o;do o=Math.floor(Math.random()*(i-t+1))+t;while(Math.abs(this.botState.position.x-o)<a.minAutoWalkDistance);this.moveTo(o)}pauseAutoWalk(){this._autoWalkInterval&&(clearInterval(this._autoWalkInterval),this._autoWalkInterval=null,this._autoWalkShouldResume=!0)}resumeAutoWalk(){this._autoWalkShouldResume&&a.enableAutoWalk&&(this.startAutoWalk(),this._autoWalkShouldResume=!1)}stopAutoWalk(){this._autoWalkInterval&&(clearInterval(this._autoWalkInterval),this._autoWalkInterval=null),this._autoWalkShouldResume=!1}cleanup(){this.stopPhysics(),this.stopAutoWalk()}static \u0275fac=function(t){return new(t||n)(h(S),h(R),h(B))};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};var ae=class n{constructor(e,t,i,o){this.botState=e;this.animationHandler=t;this.dialogueHandler=i;this.physicsHandler=o}_dragHoldTimeout=null;_spriteElement=null;initialize(e){this._spriteElement=e}onMouseDown(e){if(!this.canInteract())return;e.preventDefault(),e.stopPropagation();let t=this.getSpriteRect();t&&(this.botState.setDragState({isMouseDown:!0,mouseDownTime:Date.now(),startMouseX:e.clientX,startMouseY:e.clientY,startElementX:this.botState.position.x,startElementY:this.botState.position.y,dragOffsetX:e.clientX-t.left,dragOffsetY:e.clientY-t.top,dragDistance:0,selecting:!0,selectionEffect:!0,clickFired:!1}),a.enableDragAndDrop&&a.useSimpleDrag&&(this._dragHoldTimeout=setTimeout(()=>{this.botState.dragState.isMouseDown&&!this.botState.dragState.isDragging&&this.startDragging()},a.dragHoldMs)))}onMouseMove(e){let t=this.botState.dragState;if(!t.isMouseDown)return;let i=e.clientX-t.startMouseX,o=e.clientY-t.startMouseY,r=Math.sqrt(i*i+o*o);this.botState.setDragState({dragDistance:r}),r>a.dragThreshold&&!t.isDragging&&a.enableDragAndDrop&&this.startDragging(),t.isDragging&&this.updateDragPosition(e)}onMouseUp(e){let t=this.botState.dragState;this.clearDragTimeout(),t.selecting&&!t.isDragging&&!t.clickFired&&a.enableClick&&this.handleClick(),t.isDragging&&this.endDragging(),this.resetDragState()}onMouseLeave(e){this.botState.dragState.isDragging&&this.endDragging(),this.resetDragState()}onMouseEnter(e){}startDragging(){this.botState.dragState.isDragging||(g.drag("Iniciando drag..."),this.botState.setDragState({isDragging:!0,clickFired:!0,selecting:!1,selectionEffect:!1}),this.animationHandler.setAnimation("slashing"),this.dialogueHandler.handleInteractionDialog("drag"),this.physicsHandler.pauseAutoWalk(),this.applyDragStyles(!0))}updateDragPosition(e){let t=this.botState.dragState,i=this.botState.screenHeight,o=this.botState.screenWidth,r=e.clientX-t.dragOffsetX,s=i-(e.clientY-t.dragOffsetY)-a.spriteHeight,u=Math.max(0,Math.min(o-a.spriteWidth,r)),k=Math.max(0,s);this.botState.setPosition(u,k),g.drag(`Posici\xF3n durante drag: X=${u}, Y=${k}`),this.updateElementPosition(u,k)}endDragging(){g.drag("Finalizando drag..."),this.botState.setDragState({isDragging:!1}),this.applyDragStyles(!1);let e=this.botState.physics,t=this.botState.position;g.drag(`Posici\xF3n final del drag: X=${t.x}, Y=${t.y}, GroundY=${e.groundY}`),t.y>e.groundY?this.physicsHandler.startFalling():(this.animationHandler.setAnimation("idle"),this.botState.setCharacterState("idle"),this.dialogueHandler.setDialog("I'm not being dragged anymore!",1500),this.physicsHandler.resumeAutoWalk())}handleClick(){g.drag("Click detectado"),this.animationHandler.playOnceAnimation("kicking",()=>{this.botState.currentAnimation==="kicking"&&this.animationHandler.setAnimation("idle")}),this.dialogueHandler.handleInteractionDialog("click"),this.emitCustomClickEvent()}emitCustomClickEvent(){if(!this._spriteElement?.nativeElement.parentElement)return;let e=this.botState.position,t=new CustomEvent("skeletonClick",{detail:{x:e.x,y:e.y}});this._spriteElement.nativeElement.parentElement.dispatchEvent(t)}resetDragState(){this.botState.resetDragState(),this.clearDragTimeout()}clearDragTimeout(){this._dragHoldTimeout&&(clearTimeout(this._dragHoldTimeout),this._dragHoldTimeout=null)}applyDragStyles(e){let t=this._spriteElement?.nativeElement.parentElement;t&&(e?(t.style.zIndex="1001",t.classList.add("dragging")):(t.style.zIndex="1000",t.classList.remove("dragging")))}updateElementPosition(e,t){let i=this._spriteElement?.nativeElement.parentElement;i&&(i.style.position="fixed",i.style.left=e+"px",i.style.bottom=t+"px",i.style.transition="none")}getSpriteRect(){return this._spriteElement?.nativeElement.parentElement?.getBoundingClientRect()||null}canInteract(){return a.enableDragAndDrop||a.enableClick}getDragState(){let e=this.botState.dragState;return{isDragging:e.isDragging,isSelecting:e.selecting,canDrag:a.enableDragAndDrop,canClick:a.enableClick}}forceDragEnd(){this.botState.dragState.isDragging&&(this.endDragging(),this.resetDragState())}setDragEnabled(e){g.drag(`Drag ${e?"habilitado":"deshabilitado"}`),!e&&this.botState.dragState.isDragging&&this.forceDragEnd()}simulateClick(){a.enableClick&&this.botState.canInteract()&&this.handleClick()}cleanup(){this.clearDragTimeout(),this.resetDragState(),this._spriteElement=null}static \u0275fac=function(t){return new(t||n)(h(S),h(R),h(B),h(X))};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ct=["sprite"];function kt(n,e){if(n&1&&(d(0,"div",6),y(1),c()),n&2){let t=N(2);p(),Le(" ",t.dialog," ")}}function xt(n,e){if(n&1){let t=H();d(0,"div",2)(1,"div",3),O(2,kt,2,1,"div",4),d(3,"img",5,0),A("error",function(o){w(t);let r=N();return P(r.onImageError(o))}),c()()()}if(n&2){let t=N();p(),Y("dragging",t.isDragging)("selecting",t.selecting),Te("data-draggable",t.config.enableDragAndDrop),p(),m("ngIf",t.dialog),p(),m("src",t.getFrameSrc(),Ee)("alt",t.animation)}}var re=class n{constructor(e,t,i,o,r,s){this.botState=e;this.imagePreloader=t;this.animationHandler=i;this.physicsHandler=o;this.dialogueHandler=r;this.dragHandler=s}spriteRef;frameRate=a.defaultFrameRate;animation="idle";showButton=!1;destroy$=new Ce;currentX=a.initialX;currentY=a.initialY;facingLeft=!1;dialog="";isDragging=!1;selecting=!1;config=a;isLoaded=!1;isLoading=!1;loadProgress=0;showComponent=!1;ngOnInit(){this.showComponent=!1,this.checkAndAutoActivate()}checkAndAutoActivate(){return l(this,null,function*(){let e=["https://assets.l2terra.online/sprites/Skeleton_Crusader_3/PNG/PNG%20Sequences/Idle/0_Skeleton_Crusader_Idle_000.png","https://assets.l2terra.online/sprites/Skeleton_Crusader_3/PNG/PNG%20Sequences/Walking/0_Skeleton_Crusader_Walking_000.png","https://assets.l2terra.online/sprites/Skeleton_Crusader_3/PNG/PNG%20Sequences/Running/0_Skeleton_Crusader_Running_000.png"],t=0,i=e.length;for(let o of e)(yield this.isImageCached(o))&&t++;t===i&&(yield this.activateSkeleton(),this.emitAutoActivated())})}emitAutoActivated(){let e=new CustomEvent("skeletonAutoActivated",{detail:{autoActivated:!0}});window.dispatchEvent(e)}checkImagesCache(){return l(this,null,function*(){let e=["https://assets.l2terra.online/sprites/Skeleton_Crusader_3/PNG/PNG%20Sequences/Idle/0_Skeleton_Crusader_Idle_000.png","https://assets.l2terra.online/sprites/Skeleton_Crusader_3/PNG/PNG%20Sequences/Walking/0_Skeleton_Crusader_Walking_000.png","https://assets.l2terra.online/sprites/Skeleton_Crusader_3/PNG/PNG%20Sequences/Running/0_Skeleton_Crusader_Running_000.png"],t=0,i=e.length;for(let o of e)(yield this.isImageCached(o))&&t++})}isImageCached(e){return l(this,null,function*(){return new Promise(t=>{let i=new Image;i.onload=()=>{t(!0)},i.onerror=()=>{t(!1)},i.src=e,setTimeout(()=>{t(!1)},1e3)})})}ngOnChanges(e){e.animation&&!e.animation.firstChange&&this.isLoaded&&this.animationHandler.setAnimation(this.animation),e.frameRate&&!e.frameRate.firstChange&&this.isLoaded&&this.animationHandler.startAnimation(this.frameRate)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.cleanupHandlers()}activateSkeleton(){return l(this,null,function*(){if(!(this.isLoaded||this.isLoading)){console.log("\u{1F3AE} Activando skeleton - Iniciando carga..."),this.isLoading=!0,this.loadProgress=0;try{console.log("\u{1F3AE} Activando skeleton..."),console.log("\u{1F504} Cargando sprite!"),yield new Promise(e=>setTimeout(e,100)),yield this.loadResourcesProgressively(),this.showComponent=!0,yield new Promise(e=>requestAnimationFrame(e)),yield this.applyCSSConfig(),yield this.initializeHandlers(),this.startBasicMode(),this.isLoaded=!0,this.isLoading=!1,this.loadProgress=100,this.subscribeToStateChanges()}catch{this.isLoading=!1,this.showComponent=!1}}})}loadResourcesProgressively(){return l(this,null,function*(){let t=0;t++,this.loadProgress=Math.round(t/6*100),yield this.imagePreloader.preloadAnimation("idle"),t++,this.loadProgress=Math.round(t/6*100),yield Promise.all([this.imagePreloader.preloadAnimation("walking"),this.imagePreloader.preloadAnimation("running")]),t++,this.loadProgress=Math.round(t/6*100),yield Promise.all([this.imagePreloader.preloadAnimation("jumpStart"),this.imagePreloader.preloadAnimation("jumpLoop")]),t++,this.loadProgress=Math.round(t/6*100),yield Promise.all([this.imagePreloader.preloadAnimation("slashing"),this.imagePreloader.preloadAnimation("throwing")]),t++,this.loadProgress=Math.round(t/6*100),yield Promise.all([this.imagePreloader.preloadAnimation("kicking"),this.imagePreloader.preloadAnimation("hurt"),this.imagePreloader.preloadAnimation("idleBlinking")]),t++,this.loadProgress=Math.round(t/6*100),setTimeout(()=>{this.imagePreloader.preloadAllImagesAsync()},100)})}initializeHandlers(){return l(this,null,function*(){yield this.waitForSpriteRef(),this.dragHandler.initialize(this.spriteRef),this.animationHandler.startAnimation(this.frameRate),this.physicsHandler.startPhysics(),this.dialogueHandler.startDialogSystem()})}subscribeToStateChanges(){this.isLoaded&&(this.botState.position$.pipe(J(this.destroy$)).subscribe(e=>{this.currentX=e.x,this.currentY=e.y,this.updateDOMPosition()}),this.botState.facingLeft$.pipe(J(this.destroy$)).subscribe(e=>{this.facingLeft=e,this.updateSpriteDirection()}),this.botState.dialog$.pipe(J(this.destroy$)).subscribe(e=>{this.dialog=e}),this.botState.dragState$.pipe(J(this.destroy$)).subscribe(e=>{this.isDragging=e.isDragging,this.selecting=e.selecting}))}startBasicMode(){return l(this,null,function*(){try{yield this.imagePreloader.preloadAnimation("idle"),a.enableProgressiveLoading&&setTimeout(()=>{this.imagePreloader.preloadAllImagesAsync()},100)}catch{}})}updateDOMPosition(){if(!this.spriteRef||!this.spriteRef.nativeElement)return;let e=this.spriteRef.nativeElement.parentElement;e&&!this.isDragging&&(e.style.position="fixed",e.style.left=this.currentX+"px",e.style.bottom=this.currentY+"px",e.style.transition="none")}updateSpriteDirection(){if(!this.spriteRef||!this.spriteRef.nativeElement)return;let e=this.spriteRef.nativeElement;e&&(e.style.transform=this.facingLeft?"scaleX(-1)":"scaleX(1)")}applyCSSConfig(){return l(this,null,function*(){yield this.waitForSpriteRef();let e=this.spriteRef.nativeElement.parentElement?.parentElement;e&&(e.style.setProperty("--skeleton-sprite-width",`${a.spriteWidth}px`),e.style.setProperty("--skeleton-sprite-height",`${a.spriteHeight}px`),e.style.setProperty("--skeleton-drag-scale",a.dragScale.toString()),e.style.setProperty("--skeleton-drag-shadow",a.dragShadow),e.style.setProperty("--skeleton-selection-glow-color",a.selectionGlowColor),e.style.setProperty("--skeleton-selection-glow-intensity",`${a.selectionGlowIntensity}px`)),this.ensureFixedPosition()})}waitForSpriteRef(){return l(this,null,function*(){let t=0;for(;!this.spriteRef||!this.spriteRef.nativeElement;){if(t++,t>=50)throw console.error("\u274C Timeout esperando spriteRef"),new Error("spriteRef no disponible despu\xE9s de m\xFAltiples intentos");yield new Promise(i=>setTimeout(i,100))}})}ensureFixedPosition(){if(!this.spriteRef||!this.spriteRef.nativeElement){console.warn("\u26A0\uFE0F spriteRef no est\xE1 disponible para posicionamiento");return}let e=this.spriteRef.nativeElement.parentElement;e&&(e.style.position="fixed",e.style.bottom=this.currentY+"px",e.style.left=this.currentX+"px",e.style.transition="none",e.style.zIndex="1000")}getFrameSrc(){return this.animationHandler?this.animationHandler.getCurrentFrameUrl():""}onImageError(e){let t=e.target;(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&(console.error(`\u274C Error cargando imagen: ${t.src}`),console.error("\u{1F3AE} Verificar CORS o ruta del asset"))}onMouseEnter(e){this.isLoaded&&this.dragHandler.onMouseEnter(e)}onMouseDown(e){this.isLoaded&&this.dragHandler.onMouseDown(e)}onMouseMove(e){this.isLoaded&&this.dragHandler.onMouseMove(e)}onMouseUp(e){this.isLoaded&&this.dragHandler.onMouseUp(e)}onMouseLeave(e){this.isLoaded&&this.dragHandler.onMouseLeave(e)}onKeyDown(e){this.isLoaded&&e.code==="Space"&&a.enableJump&&(e.preventDefault(),this.physicsHandler.jump())}onWindowResize(){this.isLoaded&&this.botState.updateScreenSize()}play(e){this.isLoaded&&(this.animationHandler.setAnimation(e),this.botState.setCharacterState("custom"))}die(){this.isLoaded&&(this.animationHandler.playOnceAnimation("dying",()=>{this.animationHandler.setAnimation("idle"),this.botState.setCharacterState("idle"),this.dialogueHandler.setDialog("I'm alive again!",2e3)}),this.botState.setCharacterState("dying"),this.dialogueHandler.setDialog("I'm dying!",2500))}moveTo(e,t){this.isLoaded&&this.physicsHandler.moveTo(e,t)}jump(){this.isLoaded&&this.physicsHandler.jump()}addDialogMessage(e){this.isLoaded&&this.dialogueHandler.addDialogMessage(e)}setDialogMessages(e){this.isLoaded&&this.dialogueHandler.setDialogMessages(e)}setDialog(e,t){this.isLoaded&&this.dialogueHandler.setDialog(e,t)}forceLoadAnimation(e){return l(this,null,function*(){if(this.isLoaded)return this.imagePreloader.preloadAnimation(e)})}getLoadingStatus(){return this.imagePreloader.getLoadingStatus()}getCacheStats(){return this.imagePreloader.getCacheStats()}clearImageCache(){this.imagePreloader.clearImageCache()}getBotState(){return this.isLoaded?{loaded:!0,animation:this.botState.currentAnimation,state:this.botState.characterState,position:this.botState.position,physics:this.botState.physics,dragState:this.dragHandler.getDragState(),dialogState:this.dialogueHandler.getDialogState()}:{loaded:!1}}cleanupHandlers(){this.animationHandler.cleanup(),this.physicsHandler.cleanup(),this.dialogueHandler.cleanup(),this.dragHandler.cleanup()}static \u0275fac=function(t){return new(t||n)(D(S),D(V),D(R),D(X),D(B),D(ae))};static \u0275cmp=E({type:n,selectors:[["app-mini-ak4n1"]],viewQuery:function(t,i){if(t&1&&T(Ct,5),t&2){let o;F(o=L())&&(i.spriteRef=o.first)}},hostBindings:function(t,i){t&1&&A("mouseenter",function(r){return i.onMouseEnter(r)})("mousedown",function(r){return i.onMouseDown(r)})("mousemove",function(r){return i.onMouseMove(r)},!1,ge)("mouseup",function(r){return i.onMouseUp(r)},!1,ge)("mouseleave",function(r){return i.onMouseLeave(r)})("keydown",function(r){return i.onKeyDown(r)},!1,me)("resize",function(r){return i.onWindowResize(r)},!1,me)},inputs:{frameRate:"frameRate",animation:"animation"},features:[Ie],decls:1,vars:1,consts:[["sprite",""],["class","skeleton-wrapper",4,"ngIf"],[1,"skeleton-wrapper"],[1,"sprite-container"],["class","dialog-bubble",4,"ngIf"],[1,"sprite",3,"error","src","alt"],[1,"dialog-bubble"]],template:function(t,i){t&1&&O(0,xt,5,8,"div",1),t&2&&m("ngIf",i.showComponent)},dependencies:[$,G],styles:['[_nghost-%COMP%]{display:inline-block;position:fixed;bottom:0;left:0;-webkit-user-select:none;user-select:none;z-index:10;cursor:grab;transition:none;will-change:transform;pointer-events:auto;--skeleton-sprite-width: 100px;--skeleton-sprite-height: 100px;--skeleton-drag-scale: 1.05;--skeleton-drag-shadow: 0 8px 16px rgba(0, 0, 0, .3);--skeleton-selection-glow-color: #FFD700;--skeleton-selection-glow-intensity: 20px;--skeleton-dialog-bg-color: rgba(0, 0, 0, .8);--skeleton-dialog-text-color: white;--skeleton-shadow-color: rgba(0, 0, 0, .3)}.skeleton-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block}.sprite-container[_ngcontent-%COMP%]{display:block;position:relative;transition:none;pointer-events:auto}.sprite-container.dragging[_ngcontent-%COMP%]{cursor:grabbing;filter:drop-shadow(var(--skeleton-drag-shadow));transform:scale(var(--skeleton-drag-scale));z-index:1000}.sprite-container.selecting[_ngcontent-%COMP%]{cursor:pointer;filter:drop-shadow(0 0 var(--skeleton-selection-glow-intensity) var(--skeleton-selection-glow-color))}.sprite[_ngcontent-%COMP%]{display:block;width:var(--skeleton-sprite-width);height:var(--skeleton-sprite-height);image-rendering:pixelated;image-rendering:-moz-crisp-edges;image-rendering:crisp-edges;-webkit-user-select:none;user-select:none;pointer-events:none;transition:none}.dialog-bubble[_ngcontent-%COMP%]{position:absolute;top:-50px;left:50%;transform:translate(-50%);background:var(--skeleton-dialog-bg-color);color:var(--skeleton-dialog-text-color);padding:10px 15px;border-radius:20px;font-size:14px;font-weight:500;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;white-space:nowrap;z-index:1001;pointer-events:none;box-shadow:0 4px 12px #dabe64;text-align:center;animation:_ngcontent-%COMP%_dialogFadeIn .3s ease-out;transition:opacity .2s ease-out}.dialog-bubble[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-8px;left:50%;transform:translate(-50%);width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--skeleton-dialog-bg-color)}@keyframes _ngcontent-%COMP%_dialogFadeIn{0%{opacity:0;transform:translate(-50%) translateY(-10px)}to{opacity:1;transform:translate(-50%) translateY(0)}}.sprite-container[_ngcontent-%COMP%]:before{content:"";position:absolute;bottom:-10px;left:50%;transform:translate(-50%);width:60px;height:15px;background:var(--skeleton-shadow-color);border-radius:50%;z-index:-1}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-disabled[_ngcontent-%COMP%]{cursor:default!important}.loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:linear-gradient(135deg,#000000f2,#2c3e50f2);display:flex;align-items:center;justify-content:center;z-index:9999;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.loading-content[_ngcontent-%COMP%]{background:#000000f2;border:2px solid #dabe64;border-radius:20px;padding:40px;text-align:center;color:#fff;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;min-width:400px;box-shadow:0 20px 60px #000c;animation:_ngcontent-%COMP%_slideInUp .5s ease-out}@keyframes _ngcontent-%COMP%_slideInUp{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.loading-header[_ngcontent-%COMP%]{margin-bottom:30px}.loading-spinner[_ngcontent-%COMP%]{width:60px;height:60px;border:4px solid rgba(218,190,100,.3);border-top:4px solid #dabe64;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loading-title[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#dabe64;margin:0;text-shadow:0 2px 4px rgba(0,0,0,.5)}.loading-progress-container[_ngcontent-%COMP%]{margin:30px 0}.progress-bar[_ngcontent-%COMP%]{width:100%;height:12px;background:#ffffff1a;border-radius:6px;overflow:hidden;margin-bottom:15px;border:1px solid rgba(218,190,100,.3)}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#dabe64,#f4d03f);border-radius:6px;transition:width .3s ease;box-shadow:0 0 10px #dabe6480}.progress-text[_ngcontent-%COMP%]{font-size:18px;color:#dabe64;font-weight:600}.loading-steps[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-top:30px}.step[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:15px 10px;border-radius:10px;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);transition:all .3s ease;opacity:.5}.step.active[_ngcontent-%COMP%]{background:#dabe641a;border-color:#dabe64;opacity:1;transform:scale(1.05);box-shadow:0 4px 12px #dabe644d}.step-icon[_ngcontent-%COMP%]{font-size:24px;margin-bottom:8px;display:block}.step-text[_ngcontent-%COMP%]{font-size:12px;font-weight:500;text-align:center;line-height:1.2}@media (max-width: 768px){.loading-content[_ngcontent-%COMP%]{min-width:320px;padding:30px 20px}.loading-title[_ngcontent-%COMP%]{font-size:20px}.loading-steps[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:10px}.step[_ngcontent-%COMP%]{padding:10px 8px}.step-icon[_ngcontent-%COMP%]{font-size:20px}.step-text[_ngcontent-%COMP%]{font-size:11px}}']})};function wt(n,e){n&1&&f(0,"i",5)}function Pt(n,e){n&1&&(d(0,"div",6),f(1,"i",7),c())}function At(n,e){n&1&&(d(0,"div",8),y(1," Loading Mini Ak4n1 "),c())}function Mt(n,e){n&1&&(d(0,"div",8),y(1," Cargando... "),c())}function It(n,e){if(n&1){let t=H();d(0,"div",1),A("click",function(){w(t);let o=N();return P(o.toggleSkeleton())}),O(1,wt,1,0,"i",2)(2,Pt,2,0,"div",3)(3,At,2,0,"div",4)(4,Mt,2,0,"div",4),c()}if(n&2){let t=N();Y("loading",t.isLoading)("loaded",t.isLoaded),p(),m("ngIf",!t.isLoading),p(),m("ngIf",t.isLoading),p(),m("ngIf",!t.isLoading),p(),m("ngIf",t.isLoading)}}var se=class n{constructor(e){this.router=e}skeletonActivated=new De;isLoading=!1;isLoaded=!1;imagesAreCached=!1;shouldShowButton=!0;ngOnInit(){this.isLoaded=!1,this.isLoading=!1,this.shouldShowButton=!1,this.waitForPreloadToClose(),window.addEventListener("skeletonAutoActivated",this.onSkeletonAutoActivated.bind(this)),setTimeout(()=>{this.checkImagesCache().then(e=>{this.imagesAreCached=e,e||this.checkIfSkeletonIsAlreadyActive()})},500),setTimeout(()=>{this.checkButtonVisibility()},100)}ngOnDestroy(){window.removeEventListener("skeletonAutoActivated",this.onSkeletonAutoActivated.bind(this))}onSkeletonAutoActivated(e){setTimeout(()=>{this.isLoaded=!0,this.shouldShowButton=!1},100)}checkImagesCache(){return l(this,null,function*(){let e=["https://assets.l2terra.online/sprites/Skeleton_Crusader_3/PNG/PNG%20Sequences/Idle/0_Skeleton_Crusader_Idle_000.png","https://assets.l2terra.online/sprites/Skeleton_Crusader_3/PNG/PNG%20Sequences/Walking/0_Skeleton_Crusader_Walking_000.png","https://assets.l2terra.online/sprites/Skeleton_Crusader_3/PNG/PNG%20Sequences/Running/0_Skeleton_Crusader_Running_000.png"],t=0,i=e.length;for(let r of e)(yield this.isImageCached(r))&&t++;return t===i})}isImageCached(e){return l(this,null,function*(){return new Promise(t=>{let i=new Image;i.onload=()=>{t(!0)},i.onerror=()=>{t(!1)},i.src=e,setTimeout(()=>{t(!1)},1e3)})})}areImagesCached(){return this.imagesAreCached}updateButtonState(){}checkButtonVisibility(){let e=document.querySelector(".skeleton-button-container");if(e){let t=e.getBoundingClientRect()}}waitForPreloadToClose(){let e=0,t=100,i=()=>{e++;let o=document.querySelector(".nk-preloader");o?o.style.display!=="none"&&o.style.opacity!=="0"&&o.offsetParent!==null&&e<t?setTimeout(i,100):this.checkSpriteStateAfterPreload():this.checkSpriteStateAfterPreload()};setTimeout(i,500)}checkSpriteStateAfterPreload(){setTimeout(()=>{let e=document.querySelector(".skeleton-wrapper"),t=document.querySelector(".sprite");e&&t?e.style.display!=="none"&&e.offsetParent!==null&&t.complete&&t.naturalWidth>0?(this.isLoaded=!0,this.shouldShowButton=!1):this.shouldShowButton=!0:this.shouldShowButton=!0},1e3)}checkIfSkeletonIsAlreadyActive(){let e=document.querySelector(".skeleton-wrapper"),t=document.querySelector(".sprite");if(e&&t&&e.style.display!=="none"&&e.offsetParent!==null&&t.complete&&t.naturalWidth>0){this.isLoaded=!0,this.shouldShowButton=!1;return}this.imagesAreCached&&setTimeout(()=>{this.checkIfSkeletonIsAlreadyActive()},1e3)}toggleSkeleton(){return l(this,null,function*(){if(this.isLoaded){this.showNotification("\xA1El Skeleton ya est\xE1 activo!","info");return}if(!this.isLoading){this.isLoading=!0;try{this.skeletonActivated.emit(),yield this.waitForSkeletonToLoad(),this.isLoaded=!0,this.isLoading=!1,this.shouldShowButton=!1,this.showNotification("\xA1Skeleton cargado exitosamente!","success")}catch{this.isLoading=!1,this.showNotification("Error al cargar el Skeleton","error")}}})}waitForSkeletonToLoad(){return l(this,null,function*(){let i=0;for(;i<3e4;){let o=document.querySelector(".skeleton-wrapper"),r=document.querySelector(".sprite");if(o&&r){let s=r;if(s.complete&&s.naturalWidth>0)return}yield new Promise(s=>setTimeout(s,100)),i+=100}})}showNotification(e,t){let i=document.createElement("div");i.className=`notification notification-${t}`,i.textContent=e,i.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${t==="success"?"#27ae60":t==="error"?"#e74c3c":"#3498db"};
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 14px;
      z-index: 10001;
      animation: slideIn 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    `,document.body.appendChild(i),setTimeout(()=>{i.style.animation="slideOut 0.3s ease",setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300)},3e3)}static \u0275fac=function(t){return new(t||n)(D(U))};static \u0275cmp=E({type:n,selectors:[["app-skeleton-button"]],outputs:{skeletonActivated:"skeletonActivated"},decls:1,vars:1,consts:[["class","skeleton-button-container",3,"loading","loaded","click",4,"ngIf"],[1,"skeleton-button-container",3,"click"],["class","fas fa-robot robot-icon",4,"ngIf"],["class","loading-spinner",4,"ngIf"],["class","tooltip",4,"ngIf"],[1,"fas","fa-robot","robot-icon"],[1,"loading-spinner"],[1,"fas","fa-spinner","fa-spin"],[1,"tooltip"]],template:function(t,i){t&1&&O(0,It,5,8,"div",0),t&2&&m("ngIf",i.shouldShowButton)},dependencies:[$,G],styles:['.skeleton-button-container[_ngcontent-%COMP%]{position:absolute!important;bottom:20px!important;right:20px!important;width:60px!important;height:60px!important;background:linear-gradient(to right,#746535,#dabe64);display:flex!important;align-items:center!important;justify-content:center!important;border:1.5px groove white;cursor:pointer!important;z-index:9999!important;box-shadow:0 4px 15px #00000080!important;color:#fff!important;font-weight:700!important;clip-path:polygon(30% 0%,70% 0%,100% 30%,100% 70%,70% 100%,30% 100%,0% 70%,0% 30%)}.skeleton-button-container[_ngcontent-%COMP%]:hover{transform:scale(1.1)!important;background:#c0392b!important;box-shadow:0 6px 20px #0006!important}.skeleton-button-container[_ngcontent-%COMP%]:active{transform:scale(.95)!important}.skeleton-button-container.loading[_ngcontent-%COMP%]{background:#dabe64!important;animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite!important}.skeleton-button-container.loaded[_ngcontent-%COMP%]{background:#27ae60!important}@keyframes _ngcontent-%COMP%_pulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}.robot-icon[_ngcontent-%COMP%]{font-size:24px!important;color:#fff!important}.loading-spinner[_ngcontent-%COMP%], .check-icon[_ngcontent-%COMP%]{font-size:20px!important;color:#fff!important}.tooltip[_ngcontent-%COMP%]{position:absolute!important;bottom:70px!important;right:0!important;background:#000000e6!important;color:#fff!important;padding:8px 12px!important;border-radius:6px!important;font-size:12px!important;white-space:nowrap!important;opacity:0!important;visibility:hidden!important;transition:all .3s ease!important;pointer-events:none!important;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif!important}.tooltip[_ngcontent-%COMP%]:after{content:""!important;position:absolute!important;top:100%!important;right:20px!important;border-left:5px solid transparent!important;border-right:5px solid transparent!important;border-top:5px solid rgba(0,0,0,.9)!important}.skeleton-button-container[_ngcontent-%COMP%]:hover   .tooltip[_ngcontent-%COMP%]{opacity:1!important;visibility:visible!important}@media (max-width: 768px){.skeleton-button-container[_ngcontent-%COMP%]{width:50px!important;height:50px!important;bottom:15px!important;right:15px!important}.robot-icon[_ngcontent-%COMP%]{font-size:20px!important}.loading-spinner[_ngcontent-%COMP%], .check-icon[_ngcontent-%COMP%]{font-size:18px!important}}']})};var Dt=["skeletonComponent"],Ot=["skeletonButton"],le=class n{skeletonComponent;skeletonButton;ngOnInit(){}onSkeletonActivated(){return l(this,null,function*(){this.skeletonComponent&&(yield this.skeletonComponent.activateSkeleton())})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=E({type:n,selectors:[["app-root"]],viewQuery:function(t,i){if(t&1&&(T(Dt,5),T(Ot,5)),t&2){let o;F(o=L())&&(i.skeletonComponent=o.first),F(o=L())&&(i.skeletonButton=o.first)}},decls:14,vars:0,consts:[["skeletonComponent",""],["skeletonButton",""],["tabindex","-1","id","offCanvasChat","aria-labelledby","offCanvasChatLabel",1,"offcanvas","offcanvas-end","chatbot-container"],["src","","alt","","srcset",""],[1,"offcanvas-header"],["id","offCanvasChatLabel",1,"offcanvas-title"],[1,"fa-solid","fa-robot"],["type","button","data-bs-dismiss","offcanvas","aria-label","Cerrar",1,"btn-close","text-reset"],[1,"offcanvas-body","p-0"],[3,"skeletonActivated"]],template:function(t,i){if(t&1){let o=H();f(0,"router-outlet"),d(1,"div",2),f(2,"img",3),d(3,"div",4)(4,"h5",5),f(5,"i",6),y(6," Terra Assistant"),c(),f(7,"button",7),c(),d(8,"div",8),f(9,"app-botterra"),c()(),f(10,"app-mini-ak4n1",null,0),d(12,"app-skeleton-button",9,1),A("skeletonActivated",function(){return w(o),P(i.onSkeletonActivated())}),c()}},dependencies:[Ze,ne,re,se],styles:['.button-assistant[_ngcontent-%COMP%]{position:fixed;bottom:10%;right:50px;z-index:999;width:60px;height:60px;padding:10px;font-size:24px;background:linear-gradient(to right,#746535,#dabe64);color:#fff;border:none;border-radius:50%;box-shadow:0 2px 8px #0000004d;display:flex;align-items:center;justify-content:center;transition:transform .2s ease}.button-assistant[_ngcontent-%COMP%]:hover{transform:scale(1.05);padding:15px}.chatbot-container[_ngcontent-%COMP%]{background:linear-gradient(to bottom,#0c0f20,#000)}.offcanvas-title[_ngcontent-%COMP%]{color:#dabe64}.btn-close[_ngcontent-%COMP%]{filter:none!important;background-image:none!important;color:#dabe64!important;font-size:1.5rem;position:relative}.btn-close[_ngcontent-%COMP%]:before{content:"\\d7";color:#dabe64;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-weight:700;font-size:2.5rem}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes _ngcontent-%COMP%_slideOut{0%{transform:translate(0);opacity:1}to{transform:translate(100%);opacity:0}}.notification[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;padding:12px 20px;border-radius:6px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;font-size:14px;z-index:10001;animation:_ngcontent-%COMP%_slideIn .3s ease;box-shadow:0 4px 12px #0000004d;color:#fff}.notification-success[_ngcontent-%COMP%]{background:#27ae60}.notification-error[_ngcontent-%COMP%]{background:#e74c3c}.notification-info[_ngcontent-%COMP%]{background:#3498db}']})};Ve(le,lt).catch(n=>console.error(n));
