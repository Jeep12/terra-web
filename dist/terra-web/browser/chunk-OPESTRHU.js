import{e as g}from"./chunk-YOK3FZP7.js";import{C as e,y as h}from"./chunk-5NG36BUG.js";import{B as o,N as a,Q as l,V as p,o as r,p as s,t as u}from"./chunk-4UEPSE2P.js";var c=class n{constructor(t,i){this.http=t;this.router=i}loggedIn=!1;email;login(t){return this.http.post(`${e.apiUrl}api/auth/login`,t,{withCredentials:!0}).pipe(a(()=>{this.setEmail(t.email),this.loggedIn=!0}))}register(t){return this.http.post(`${e.apiUrl}api/auth/register`,t)}logout(){return this.http.post(`${e.apiUrl}api/auth/logout`,{},{withCredentials:!0}).pipe(a(()=>{this.loggedIn=!1,this.router.navigate(["/login"])}))}recoveryPassword(t){return this.http.post(`${e.apiUrl}api/auth/resend-reset-email?email=${encodeURIComponent(t)}`,{})}resetPassword(t,i){return this.http.post(`${e.apiUrl}api/auth/reset-password?token=${encodeURIComponent(t)}`,{password:i},{withCredentials:!0})}getCurrentUser(){return this.http.get(`${e.apiUrl}api/auth/me`,{withCredentials:!0}).pipe(o(t=>t.name==="SilentAuthError"?s(()=>t):t.status===401||t.status===403?s(()=>t):(t.status===401&&(t.error?.message?.includes("2FA requerido")&&this.router.navigate(["/two-factor-step"]),t.error.code==="2FA_REQUIRED_UNTRUSTED_DEVICE"&&this.router.navigate(["/two-factor-step"])),s(()=>t))))}isLoggedIn(){return this.loggedIn?r(!0):this.getCurrentUser().pipe(a(()=>this.loggedIn=!0),u(()=>!0),o(t=>t.name==="SilentAuthError"?(this.loggedIn=!1,r(!1)):t.status===401||t.status===403?(this.loggedIn=!1,r(!1)):t.status===401&&t.error?.code==="2FA_REQUIRED_NO_DEVICE"?(this.router.navigate(["/two-factor-step"]),r(!1)):(this.loggedIn=!1,r(!1))))}resendVerificationEmail(t){return this.http.post(`${e.apiUrl}api/auth/resend-verification`,{email:t})}verifyEmail(t){return this.http.get(`${e.apiUrl}api/auth/verify-email?token=${encodeURIComponent(t)}`)}recentActivity(){return this.http.get(`${e.apiUrl}api/auth/recent-activity`,{withCredentials:!0})}request2FACode(){return this.http.post(`${e.apiUrl}api/auth/request-2fa-code`,{},{withCredentials:!0})}verify2FACode(t){return this.http.post(`${e.apiUrl}api/auth/verify-2fa-code?code=${encodeURIComponent(t)}`,{},{withCredentials:!0})}toggle2FA(t){return this.http.post(`${e.apiUrl}api/auth/2fa/toggle`,{enabled:t},{withCredentials:!0})}setEmail(t){this.email=t}getEmail(){return this.email}getTrustedDevices(){return this.http.get(`${e.apiUrl}api/auth/trusted-devices`,{withCredentials:!0})}removeTrustedDevice(t){return this.http.post(`${e.apiUrl}api/auth/remove-trusted-device`,{deviceId:t})}static \u0275fac=function(i){return new(i||n)(p(h),p(g))};static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})};export{c as a};
