import{l as h,s as c,x as e}from"./chunk-H4TVSPRO.js";import{A as o,M as n,P as l,U as p,o as i,p as a,s as u}from"./chunk-IYZISLN6.js";var g=class s{constructor(t,r){this.http=t;this.router=r}loggedIn=!1;email;login(t){return this.http.post(`${e.apiUrl}api/auth/login`,t,{withCredentials:!0})}register(t){return this.http.post(`${e.apiUrl}api/auth/register`,t)}logout(){return this.http.post(`${e.apiUrl}api/auth/logout`,{},{withCredentials:!0}).pipe(n(()=>{this.loggedIn=!1,this.router.navigate(["/login"])}))}recoveryPassword(t){return this.http.post(`${e.apiUrl}api/auth/resend-reset-email?email=${encodeURIComponent(t)}`,{})}resetPassword(t,r){return this.http.post(`${e.apiUrl}api/auth/reset-password?token=${encodeURIComponent(t)}`,{password:r},{withCredentials:!0})}getCurrentUser(){return this.http.get(`${e.apiUrl}api/auth/me`,{withCredentials:!0}).pipe(o(t=>{if(t.status===401){if(t.error?.message?.includes("2FA requerido"))return this.router.navigate(["/two-factor-step"]),a(()=>new Error("2FA required"));if(t.error.code==="2FA_REQUIRED_UNTRUSTED_DEVICE")return this.router.navigate(["/two-factor-step"]),a(()=>new Error("2FA required"))}return a(()=>t)}))}isLoggedIn(){return this.loggedIn?i(!0):this.getCurrentUser().pipe(n(()=>this.loggedIn=!0),u(()=>!0),o(t=>t.status===401&&t.error?.code==="2FA_REQUIRED_NO_DEVICE"?(this.router.navigate(["/two-factor-step"]),i(!1)):(this.loggedIn=!1,i(!1))))}resendVerificationEmail(t){return this.http.post(`${e.apiUrl}api/auth/resend-verification`,{email:t})}verifyEmail(t){return this.http.get(`${e.apiUrl}api/auth/verify-email?token=${encodeURIComponent(t)}`)}recentActivity(){return this.http.get(`${e.apiUrl}api/auth/recent-activity`,{withCredentials:!0})}request2FACode(){return this.http.post(`${e.apiUrl}api/auth/request-2fa-code`,{},{withCredentials:!0})}verify2FACode(t){return this.http.post(`${e.apiUrl}api/auth/verify-2fa-code?code=${encodeURIComponent(t)}`,{},{withCredentials:!0})}toggle2FA(t){return this.http.post(`${e.apiUrl}api/auth/2fa/toggle`,{enabled:t},{withCredentials:!0})}setEmail(t){this.email=t}getEmail(){return this.email}getTrustedDevices(){return this.http.get(`${e.apiUrl}api/auth/trusted-devices`,{withCredentials:!0})}removeTrustedDevice(t){return this.http.post(`${e.apiUrl}api/auth/remove-trusted-device`,{deviceId:t})}static \u0275fac=function(r){return new(r||s)(p(h),p(c))};static \u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})};export{g as a};
