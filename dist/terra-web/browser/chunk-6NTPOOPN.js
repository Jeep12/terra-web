import{b as F,d as A,e as N,f as L,g as W,h as z,o as D,q as R,s as q,t as B}from"./chunk-THFTEXFF.js";import{b as P,d as O,f as k,g as E,o as S,t as V}from"./chunk-OOGZQ4YG.js";import{$ as c,Ba as d,Ga as w,La as T,Qa as M,Xa as f,aa as l,ab as r,bb as a,cb as u,fb as C,ib as m,jb as s,lb as p,mb as I,nb as v,pb as x,qb as _,rb as h}from"./chunk-Y3DSR7KR.js";function U(g,i){g&1&&(r(0,"div",17),u(1,"div",18),a())}function G(g,i){if(g&1){let t=C();r(0,"div",9)(1,"div",10),u(2,"i",11),p(3," You enabled 2FA. Enter your email to receive the verification code. "),a(),r(4,"button",12),m("click",function(){c(t);let e=s();return l(e.send2FACode())}),M(5,U,2,0,"div",13),u(6,"i",14),p(7),a(),r(8,"p",15),p(9," The code is valid for 5 minutes. If you don\u2019t see it, check your spam or junk folder. "),a(),u(10,"hr"),r(11,"button",16),m("click",function(){c(t);let e=s();return l(e.navigateToLogin())}),p(12,"Go to Login"),a()()}if(g&2){let t=s();d(4),f("disabled",t.loading),d(),f("ngIf",t.loading),d(2),v(" ",t.loading?"":"Send code 2FA"," ")}}function Y(g,i){if(g&1){let t=C();r(0,"div",9)(1,"div",10),p(2," A 6-digit code was sent to your email. Enter it to complete login. "),a(),r(3,"form",19),m("ngSubmit",function(){c(t);let e=s();return l(e.verify2FACode())}),r(4,"div",20)(5,"label",21),u(6,"i",22),p(7," Enter 2FA code"),a(),r(8,"div",23)(9,"input",24),h("ngModelChange",function(e){c(t);let n=s();return _(n.codeInputs[0],e)||(n.codeInputs[0]=e),l(e)}),m("input",function(e){c(t);let n=s();return l(n.onInputChange(e,0))})("paste",function(e){c(t);let n=s();return l(n.onPaste(e))}),a(),r(10,"input",25),h("ngModelChange",function(e){c(t);let n=s();return _(n.codeInputs[1],e)||(n.codeInputs[1]=e),l(e)}),m("input",function(e){c(t);let n=s();return l(n.onInputChange(e,1))}),a(),r(11,"input",26),h("ngModelChange",function(e){c(t);let n=s();return _(n.codeInputs[2],e)||(n.codeInputs[2]=e),l(e)}),m("input",function(e){c(t);let n=s();return l(n.onInputChange(e,2))}),a(),r(12,"input",27),h("ngModelChange",function(e){c(t);let n=s();return _(n.codeInputs[3],e)||(n.codeInputs[3]=e),l(e)}),m("input",function(e){c(t);let n=s();return l(n.onInputChange(e,3))}),a(),r(13,"input",28),h("ngModelChange",function(e){c(t);let n=s();return _(n.codeInputs[4],e)||(n.codeInputs[4]=e),l(e)}),m("input",function(e){c(t);let n=s();return l(n.onInputChange(e,4))}),a(),r(14,"input",29),h("ngModelChange",function(e){c(t);let n=s();return _(n.codeInputs[5],e)||(n.codeInputs[5]=e),l(e)}),m("input",function(e){c(t);let n=s();return l(n.onInputChange(e,5))}),a()()(),r(15,"button",30),p(16," Verify Code "),u(17,"i",31),a(),r(18,"p",32),p(19," Didn't receive the code? Go back to request a new one. "),u(20,"br"),r(21,"button",33),m("click",function(){c(t);let e=s();return l(e.goBackToEmail())}),u(22,"i",34),p(23," Back "),a()()()()}if(g&2){let t=s();d(9),x("ngModel",t.codeInputs[0]),d(),x("ngModel",t.codeInputs[1]),d(),x("ngModel",t.codeInputs[2]),d(),x("ngModel",t.codeInputs[3]),d(),x("ngModel",t.codeInputs[4]),d(),x("ngModel",t.codeInputs[5]),d(),f("disabled",t.isCodeIncomplete())}}function H(g,i){if(g&1){let t=C();r(0,"div",35),p(1," Your session has expired. Please log in again and try to send the code. "),r(2,"button",33),m("click",function(){c(t);let e=s();return l(e.navigateToLogin())}),u(3,"i",34),p(4," Back to Login "),a()()}}function K(g,i){if(g&1&&(r(0,"div",36),u(1,"i",37),p(2,"\xA0 "),r(3,"span",38),p(4),a(),u(5,"hr"),p(6),a()),g&2){let t=s();f("ngClass",t.isError?"alert-danger":"alert-success"),d(4),I(t.email),d(2),v(" ",t.responseMessage," ")}}var j=class g{constructor(i,t){this.authService=i;this.router=t}currentStep=1;emailSent=!1;email="";isError=!1;responseMessage="";loading=!1;loadingResend=!1;codeInputs=["","","","","",""];showNoTokenError=!1;isCodeIncomplete(){return this.codeInputs.some(i=>i==="")}send2FACode(){this.loading=!0,this.responseMessage="",this.isError=!1,this.authService.request2FACode().subscribe({next:i=>{this.loading=!1,this.currentStep=2,i?.message?(this.responseMessage=i.message,this.isError=!1,this.emailSent=!0):(this.responseMessage="Unexpected response",this.isError=!0)},error:i=>{this.loading=!1,this.isError=!0,this.currentStep=2,this.email=i.error.email,i.error.code=="NO_TOKEN"?this.showNoTokenError=!0:i.error.code=="2FA_REQUIRED_NO_DEVICE"?(alert("Please log in again to be redirected."),this.navigateToLogin(),this.showNoTokenError=!0):this.showNoTokenError=!1,this.responseMessage=i?.error?.message||i?.error||"Error sending code"}})}onInputChange(i,t){let o=i.target,e=o.value;if(!/^\d?$/.test(e)){o.value="",this.codeInputs[t]="";return}if(this.codeInputs[t]=e,e&&t<this.codeInputs.length-1){let n=o.nextElementSibling;n&&n.focus()}}onPaste(i){i.preventDefault();let o=(i.clipboardData?.getData("text")||"").substring(0,6).split(""),e=document.querySelectorAll(".code-input");o.forEach((y,b)=>{this.codeInputs[b]=y,e[b]&&(e[b].value=y)});let n=e[o.length];n&&n.focus()}verify2FACode(){let i=this.codeInputs.join("");if(this.isCodeIncomplete()){this.isError=!0,this.responseMessage="Please enter the 6-digit code";return}let t=localStorage.getItem("deviceId");t||(t=this.generateUUID(),localStorage.setItem("deviceId",t)),this.loading=!0,this.responseMessage="",this.isError=!1,this.authService.verify2FACode(i).subscribe({next:o=>{this.loading=!1,this.responseMessage=o.message||"Code verified successfully!",this.isError=!1},error:o=>{this.loading=!1,this.isError=!0,this.responseMessage=o.error?.message||"Invalid 2FA code, try again."}})}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{let t=Math.random()*16|0;return(i==="x"?t:t&3|8).toString(16)})}goBackToEmail(){this.currentStep=1,this.responseMessage="",this.isError=!1,this.codeInputs=["","","","","",""]}resendCode(){this.loadingResend||(this.loadingResend=!0,this.responseMessage="",this.isError=!1,setTimeout(()=>{this.loadingResend=!1,this.responseMessage="2FA code resent to "+this.email},1500))}navigateToLogin(){this.router.navigate(["/login"])}static \u0275fac=function(t){return new(t||g)(w(V),w(S))};static \u0275cmp=T({type:g,selectors:[["app-two-factor"]],decls:11,vars:4,consts:[[1,"auth-container"],[2,"position","relative","width","300px","height","227px"],["ngSrc","assets/images/lineage2Terra_blanco.webp","fill","","alt","Logo Terra","priority","",1,"logoTerra"],[1,"auth-card"],[1,"auth-title"],[1,"fa-solid","fa-shield-halved"],["class","form-step",4,"ngIf"],["class","error-not-token","style","color: red; margin-top: 10px;",4,"ngIf"],["class","alert text-center","role","alert","style","margin-top: 15px;",3,"ngClass",4,"ngIf"],[1,"form-step"],[1,"info-message"],[1,"fa-solid","fa-bell"],["type","button",1,"btn-primary",3,"click","disabled"],["class","loading-container",4,"ngIf"],[1,"fas","fa-paper-plane"],[2,"color","#dabe64","font-size","0.9em","margin-top","10px","text-align","center"],[1,"btn-secondary",3,"click"],[1,"loading-container"],[1,"loading-bar"],[3,"ngSubmit"],[1,"form-group"],[1,"code-label"],[1,"fa-solid","fa-lock"],[1,"code-input-wrapper"],["maxlength","1","type","text","name","code0","placeholder","0","required","",1,"code-input",3,"ngModelChange","input","paste","ngModel"],["maxlength","1","type","text","name","code1","placeholder","0","required","",1,"code-input",3,"ngModelChange","input","ngModel"],["maxlength","1","type","text","name","code2","placeholder","0","required","",1,"code-input",3,"ngModelChange","input","ngModel"],["maxlength","1","type","text","name","code3","placeholder","0","required","",1,"code-input",3,"ngModelChange","input","ngModel"],["maxlength","1","type","text","name","code4","placeholder","0","required","",1,"code-input",3,"ngModelChange","input","ngModel"],["maxlength","1","type","text","name","code5","placeholder","0","required","",1,"code-input",3,"ngModelChange","input","ngModel"],["type","submit",1,"btn-primary",3,"disabled"],[1,"fas","fa-check"],[1,"code-help-text",2,"margin-top","15px"],["type","button",1,"btn-secondary",2,"margin-top","15px",3,"click"],[1,"fas","fa-arrow-left"],[1,"error-not-token",2,"color","red","margin-top","10px"],["role","alert",1,"alert","text-center",2,"margin-top","15px",3,"ngClass"],[1,"fa-solid","fa-triangle-exclamation"],[2,"text-decoration","underline"]],template:function(t,o){t&1&&(r(0,"div",0)(1,"div",1),u(2,"img",2),a(),r(3,"div",3)(4,"h2",4),u(5,"i",5),p(6," Two-Factor Authentication "),a(),M(7,G,13,3,"div",6)(8,Y,24,7,"div",6)(9,H,5,0,"div",7)(10,K,7,3,"div",8),a()()),t&2&&(d(7),f("ngIf",o.currentStep===1),d(),f("ngIf",o.currentStep===2),d(),f("ngIf",o.showNoTokenError),d(),f("ngIf",o.responseMessage))},dependencies:[k,P,O,q,z,F,A,N,D,R,W,L,B,E],styles:['.auth-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;padding:20px;background:linear-gradient(to bottom,#0c0f20,#000);font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;box-sizing:border-box}.auth-card[_ngcontent-%COMP%]{background-color:#11111165;border-radius:12px;padding:30px;width:100%;max-width:400px;border:1px solid #3b3b3b}.auth-title[_ngcontent-%COMP%]{color:#f9f9f9;text-align:center;margin-bottom:30px;font-weight:600;font-size:24px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;color:#e0e0e0;font-size:14px}.form-control[_ngcontent-%COMP%]{width:100%;border-radius:8px;height:50px;border:1px solid rgba(255,255,255,.2);background-color:#ffffff12;color:#fff;font-size:16px;transition:all .3s ease}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#dabe64;box-shadow:0 0 0 2px #dabe6440}.form-control[_ngcontent-%COMP%]::placeholder{color:#fff6}.divider[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center;color:#ffffff80;font-size:14px;margin:20px 0}.divider[_ngcontent-%COMP%]:before, .divider[_ngcontent-%COMP%]:after{content:"";flex:1;border-bottom:1px solid rgba(255,255,255,.2)}.divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:0 10px}.social-buttons[_ngcontent-%COMP%]{display:flex;gap:12px}.btn-social[_ngcontent-%COMP%]{flex:1;padding:10px;border:1px solid rgba(255,255,255,.2);border-radius:8px;background-color:#ffffff12;color:#fff;font-size:14px;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center}.btn-social[_ngcontent-%COMP%]:hover{background-color:#ffffff1f}.social-icon[_ngcontent-%COMP%]{margin-right:8px}.auth-links[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:24px}.auth-link[_ngcontent-%COMP%]{color:#dabe64;text-decoration:none;font-size:14px;cursor:pointer;transition:all .3s ease}.auth-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.error-message[_ngcontent-%COMP%]{color:#ff6b6b;font-size:12px;margin-top:5px}.form-step[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 480px){.auth-card[_ngcontent-%COMP%]{padding:20px}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%], .form-control[_ngcontent-%COMP%]{padding:10px}.social-buttons[_ngcontent-%COMP%]{flex-direction:column}.auth-links[_ngcontent-%COMP%]{flex-direction:column;align-items:center;gap:10px}}.auth-container.dark-mode[_ngcontent-%COMP%]{background:linear-gradient(to bottom,#121212,#000);color:#ddd}.auth-container.dark-mode[_ngcontent-%COMP%]   .auth-card[_ngcontent-%COMP%]{background-color:#1e1e1eb3;border-color:#555}.auth-container.dark-mode[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{background-color:#3232324d;color:#eee;border-color:#666}.auth-container.dark-mode[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .auth-container.dark-mode[_ngcontent-%COMP%]   .auth-title[_ngcontent-%COMP%]{color:#ccc}.info-message[_ngcontent-%COMP%]{gap:10px;background:#dabe641a;border:1px solid rgba(218,190,100,.3);border-radius:8px;color:#dabe64;margin:0 auto 15px;width:100%;padding:15px}.loading-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:4px;overflow:hidden}.loading-bar[_ngcontent-%COMP%]{background-color:#0c0f204d;min-width:100%;min-height:4px;position:relative;overflow:hidden}.loading-bar[_ngcontent-%COMP%]:after{content:"";min-height:4px;position:absolute;background:linear-gradient(to right,#dabe64cc,#fffc);transform:translate(-100%);animation:_ngcontent-%COMP%_loadingAnim 2s infinite}.loading-bar[_ngcontent-%COMP%]:before{content:"";min-height:4px;position:absolute;background:linear-gradient(to right,#dabe64cc,#fffc);transform:translate(-100%);animation:_ngcontent-%COMP%_loadingAnim 2s infinite;animation-delay:1s}@keyframes _ngcontent-%COMP%_loadingAnim{0%{transform:translate(-150%);min-width:100px}to{transform:translate(300%);min-width:400px}}.container-input-code[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.code-label[_ngcontent-%COMP%]{color:#dabe64;font-weight:600;display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:10px}.code-input-wrapper[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center}.code-input[_ngcontent-%COMP%]{width:50px;height:50px;font-size:20px;font-weight:600;text-align:center;border:2px solid #3b3b3b;border-radius:8px;background:#0006;color:#dabe64;transition:all .3s ease}.code-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#dabe64;box-shadow:0 0 0 3px #dabe6433;background:#0009}.code-input[_ngcontent-%COMP%]::placeholder{color:#666}.code-help-text[_ngcontent-%COMP%]{margin-top:15px;color:#b8b8b8;font-size:.9em}.link-button[_ngcontent-%COMP%]{background:none;border:none;color:#dabe64;text-decoration:underline;cursor:pointer;font-size:inherit}.link-button[_ngcontent-%COMP%]:hover{color:#96813f}']})};export{j as TwoFactorComponent};
