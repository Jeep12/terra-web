import{b as Nt,d as Xt,g as Ut,u as Kt}from"./chunk-H3UTXL2W.js";import{a as zt}from"./chunk-474OEAUR.js";import{a as Tt,b as jt,e as Wt,f as Yt,i as $t,j as at}from"./chunk-S5WBJKBX.js";import{A as Lt,B as Rt,C as U,j as Ot,k as Ht,l as N,n as Ft,p as X,x as nt,y as Et,z as Bt}from"./chunk-CSXME6MI.js";import{$a as yt,Bb as L,C as Y,Cb as R,Db as j,Fb as D,Gb as Ct,Hb as Dt,Ja as bt,Jb as wt,Ka as vt,Kb as Mt,Lb as xt,N as E,O as ht,Oa as tt,Pa as et,Pb as it,Qa as p,Qb as kt,R as u,S as ut,Sb as At,Va as A,Vb as It,W as g,X as k,Xb as Pt,_a as O,a as x,aa as ft,ba as I,ca as P,d as S,db as B,j as mt,k as b,kb as St,lb as f,nb as $,o as ct,p as Z,qb as d,rb as c,s as gt,sb as v,t as pt,vb as z,yb as H,zb as _t}from"./chunk-HU55LA37.js";var Vt=(n,t)=>{let e=k(zt),i=k(Yt);return e.isLoggedIn().pipe(ht(a=>{a||i.navigate(["/login"])}),pt(a=>a),Y(()=>(i.navigate(["/login"]),ct(!1))))};var ot=[{path:"",loadComponent:()=>import("./chunk-KVL7QRYU.js").then(n=>n.WebsiteComponent),children:[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",loadComponent:()=>import("./chunk-H2OXOMCG.js").then(n=>n.HomeComponent)},{path:"gallery",loadComponent:()=>import("./chunk-JW7LZMK7.js").then(n=>n.GalleryComponent)},{path:"downloads",loadComponent:()=>import("./chunk-Y6TACTF2.js").then(n=>n.DownloadComponent)}]},{path:"login",loadComponent:()=>import("./chunk-6JQCG62A.js").then(n=>n.LoginComponent)},{path:"register",loadComponent:()=>import("./chunk-PCTUXW6S.js").then(n=>n.RegisterComponent)},{path:"reset-password",loadComponent:()=>import("./chunk-WSCFYSMU.js").then(n=>n.ResetPasswordComponent)},{path:"forgot-password",loadComponent:()=>import("./chunk-EW5KINSS.js").then(n=>n.ForgotPasswordComponent)},{path:"resend-email-verification",loadComponent:()=>import("./chunk-MHEVAFU6.js").then(n=>n.ResendEmailVerificationComponent)},{path:"verify-email",loadComponent:()=>import("./chunk-OXAF7ODR.js").then(n=>n.VerifyEmailComponent)},{path:"two-factor-step",loadComponent:()=>import("./chunk-NY26VPF2.js").then(n=>n.TwoFactorComponent)},{path:"dashboard",loadComponent:()=>import("./chunk-EDCJBWEY.js").then(n=>n.Dashboard2Component),canActivate:[Vt],children:[{path:"",pathMatch:"full",redirectTo:"home-dashboard"},{path:"home-dashboard",loadComponent:()=>import("./chunk-E4PDHU2U.js").then(n=>n.DashboardHomeComponent)},{path:"create-account-game",loadComponent:()=>import("./chunk-QTOJLCU7.js").then(n=>n.CreateAccountGameComponent)},{path:"change-password-game",loadComponent:()=>import("./chunk-7DQT6VLB.js").then(n=>n.ChangePasswordGameComponent)},{path:"buy-terra-coin",loadComponent:()=>import("./chunk-H23FFRBR.js").then(n=>n.BuyTerraCoinComponent)},{path:"send-terra-coin",loadComponent:()=>import("./chunk-K475RFWH.js").then(n=>n.SendTerraCoinComponent)},{path:"support",loadComponent:()=>import("./chunk-QTLLUL7O.js").then(n=>n.SupportComponent)},{path:"offline-market",loadComponent:()=>import("./chunk-RKWT62TQ.js").then(n=>n.OfflineMarketComponent)},{path:"setting-account-master",loadComponent:()=>import("./chunk-4DW6YZTT.js").then(n=>n.SettingsAccountMasterComponent)}]},{path:"**",loadComponent:()=>import("./chunk-7RDI2YAC.js").then(n=>n.WebsiteNotFoundComponent)}],Gt=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=yt({type:n});static \u0275inj=ut({imports:[at.forRoot(ot),at]})};var Jt=(n,t)=>{let e=localStorage.getItem("deviceId")||"",i=n.url.includes("n8n.l2terra.online"),a=n.url.includes("/api/auth/me"),r=i?n.headers:n.headers.set("X-Device-Id",e),s=n.clone({withCredentials:!i,headers:r});return t(s).pipe(Y(l=>{if(a&&(l.status===401||l.status===403)){let h=new Error;return h.name="SilentAuthError",h.message=l.message,h.stack=l.stack,Object.defineProperty(h,"status",{value:l.status,writable:!1}),Object.defineProperty(h,"error",{value:l.error,writable:!1}),Z(()=>h)}return Z(()=>l)}))};var Qt={providers:[It({eventCoalescing:!0}),$t(ot),Bt(Rt(),Lt([Jt]))]};var K=class n{constructor(t){this.http=t}WEBHOOK_URL=U.WEBHOOK_URL_N8N;AUTH_USERNAME=U.AUTH_USERNAME_N8N;AUTH_PASSWORD=U.AUTH_PASSWORD_N8N;sendMessageAsync(t){return S(this,null,function*(){let e={sessionId:"asdasdsa",message:t,timestamp:new Date().toISOString(),action:"sendMessage"},i=new nt({"Content-Type":"application/json",Authorization:"Basic "+btoa(`${this.AUTH_USERNAME}:${this.AUTH_PASSWORD}`)});try{return yield gt(this.http.post(this.WEBHOOK_URL,e,{headers:i,withCredentials:!1}))}catch(a){throw console.error("Error al enviar mensaje:",a),a}})}sendMessage(t){let e={sessionId:"asdasdsa",message:t,timestamp:new Date().toISOString(),action:"sendMessage"},i=new nt({"Content-Type":"application/json",Authorization:"Basic "+btoa(`${this.AUTH_USERNAME}:${this.AUTH_PASSWORD}`)});return this.http.post(this.WEBHOOK_URL,e,{headers:i,withCredentials:!1})}static \u0275fac=function(e){return new(e||n)(g(Et))};static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};var ne=["messagesContainer"],ae=["messageInput"],oe=(n,t)=>({"user-wrapper":n,"bot-wrapper":t}),re=(n,t)=>({"user-message":n,"bot-message":t});function se(n,t){n&1&&(d(0,"div",13)(1,"h3"),D(2,"Hello! \u{1F44B}"),c(),d(3,"p"),D(4,"How can I help you today?"),c()())}function le(n,t){if(n&1&&(d(0,"div",14)(1,"div",15)(2,"div",16),v(3,"div",17),d(4,"div",18),D(5),kt(6,"date"),c()()()()),n&2){let e=t.$implicit;f("ngClass",it(7,oe,e.sender==="user",e.sender==="bot")),p(),f("ngClass",it(10,re,e.sender==="user",e.sender==="bot")),p(2),f("innerHTML",e.text,bt),p(2),Ct(At(6,4,e.timestamp,"shortTime"))}}function de(n,t){n&1&&(d(0,"div",19)(1,"div",20)(2,"div",21),v(3,"span")(4,"span")(5,"span"),c(),d(6,"span",22),D(7,"Typing..."),c()()())}function me(n,t){n&1&&(d(0,"span",23),v(1,"i",24),c())}function ce(n,t){n&1&&(d(0,"span",25),v(1,"i",26),c())}var V=class n{messagesContainer;messageInput;msg="";messages=[];isLoading=!1;shouldScrollToBottom=!1;chatbotService=k(K);cdRef=k(Pt);sanitizer=k(jt);ngAfterViewChecked(){this.shouldScrollToBottom&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}sendMessage(){return S(this,null,function*(){let t=this.msg.trim();if(!(!t||this.isLoading)){this.addMessage(t,"user"),this.msg="",this.isLoading=!0,this.shouldScrollToBottom=!0,setTimeout(()=>{this.messageInput?.nativeElement?.focus()},100);try{let e=yield this.chatbotService.sendMessageAsync(t),i=this.extractBotResponse(e);this.addMessage(i,"bot")}catch(e){this.addMessage("Error al conectar con el servicio","bot"),console.error("Error:",e)}finally{this.isLoading=!1,this.shouldScrollToBottom=!0,this.forceViewUpdate()}}})}onKeyPress(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}addMessage(t,e){let i=e==="bot"?this.sanitizer.bypassSecurityTrustHtml(t.replace(/\n/g,"<br>")):t;this.messages=[...this.messages,{text:i,sender:e,timestamp:new Date}],this.shouldScrollToBottom=!0,this.cdRef.detectChanges()}extractBotResponse(t){return t?.output||t?.reply||t?.message||t?.data?.message||t?.result||JSON.stringify(t)||"Recib\xED tu mensaje"}forceViewUpdate(){this.cdRef.detectChanges()}scrollToBottom(){if(this.messagesContainer?.nativeElement){let t=this.messagesContainer.nativeElement;t.scrollTop=t.scrollHeight}}trackByMessage(t,e){return t}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=O({type:n,selectors:[["app-botterra"]],viewQuery:function(e,i){if(e&1&&(L(ne,5),L(ae,5)),e&2){let a;R(a=j())&&(i.messagesContainer=a.first),R(a=j())&&(i.messageInput=a.first)}},decls:13,vars:11,consts:[["messagesContainer",""],["messageInput",""],[1,"chatbot-container"],[1,"messages-container"],["class","welcome-message",4,"ngIf"],["class","message-wrapper",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],["class","loading-wrapper",4,"ngIf"],[1,"input-container"],[1,"input-wrapper"],["placeholder","Type your message...","name","message","autocomplete","off",1,"message-input",3,"ngModelChange","keypress","ngModel","disabled"],[1,"send-button",3,"click","disabled"],["class","send-icon",4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"welcome-message"],[1,"message-wrapper",3,"ngClass"],[1,"message",3,"ngClass"],[1,"message-content"],[1,"message-text",3,"innerHTML"],[1,"message-time"],[1,"loading-wrapper"],[1,"loading-message"],[1,"typing-indicator"],[1,"typing-text"],[1,"send-icon"],[1,"fa-solid","fa-paper-plane"],[1,"loading-spinner"],[1,"fa-solid","fa-circle-notch","fa-spin"]],template:function(e,i){if(e&1){let a=z();d(0,"div",2)(1,"div",3,0),B(3,se,5,0,"div",4)(4,le,7,13,"div",5)(5,de,8,0,"div",6),c(),d(6,"div",7)(7,"div",8)(8,"input",9,1),xt("ngModelChange",function(s){return I(a),Mt(i.msg,s)||(i.msg=s),P(s)}),H("keypress",function(s){return I(a),P(i.onKeyPress(s))}),c(),d(10,"button",10),H("click",function(){return I(a),P(i.sendMessage())}),B(11,me,2,0,"span",11)(12,ce,2,0,"span",12),c()()()()}e&2&&(p(3),f("ngIf",i.messages.length===0),p(),f("ngForOf",i.messages)("ngForTrackBy",i.trackByMessage),p(),f("ngIf",i.isLoading),p(3),wt("ngModel",i.msg),f("disabled",i.isLoading),p(2),$("loading",i.isLoading),f("disabled",!i.msg.trim()||i.isLoading),p(),f("ngIf",!i.isLoading),p(),f("ngIf",i.isLoading))},dependencies:[X,Ot,Ht,N,Ft,Kt,Nt,Xt,Ut],styles:['.chatbot-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background:linear-gradient(to bottom,#0c0f20,#000);border-radius:16px;overflow:hidden;box-shadow:0 20px 40px #0000004d;position:relative}.chatbot-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,#dabe64,transparent)}.messages-container[_ngcontent-%COMP%]{flex:1;padding:24px;overflow-y:auto;display:flex;flex-direction:column;gap:16px;scroll-behavior:smooth}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#0000001a;border-radius:3px}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:linear-gradient(to bottom,#746535,#dabe64);border-radius:3px}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:linear-gradient(to bottom,#dabe64,#746535)}.welcome-message[_ngcontent-%COMP%]{text-align:center;padding:32px 20px;background:linear-gradient(135deg,#dabe641a,#7465351a);border:1px solid rgba(218,190,100,.3);border-radius:16px;margin-bottom:16px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.welcome-icon[_ngcontent-%COMP%]{margin-bottom:16px}.welcome-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2.5rem;color:#dabe64;filter:drop-shadow(0 0 10px rgba(218,190,100,.5))}.welcome-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#dabe64;margin:0 0 8px;font-size:1.5rem;font-weight:600}.welcome-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#dabe64cc;margin:0;font-size:1rem}.message-wrapper[_ngcontent-%COMP%]{display:flex;animation:_ngcontent-%COMP%_slideIn .4s ease-out}.user-wrapper[_ngcontent-%COMP%]{justify-content:flex-end}.bot-wrapper[_ngcontent-%COMP%]{justify-content:flex-start}.message[_ngcontent-%COMP%]{max-width:75%;padding:16px 20px;border-radius:20px;position:relative;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);transition:all .3s ease}.message[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 20px #0000004d}.bot-message[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1119,#1e1e1e99);color:#dabe64;border:1px solid rgba(218,190,100,.3);border-bottom-left-radius:6px;position:relative}.bot-message[_ngcontent-%COMP%]:before{content:"";position:absolute;left:-8px;bottom:0;width:0;height:0;border-style:solid;border-width:0 8px 12px 0;border-color:transparent rgba(218,190,100,.3) transparent transparent}.user-message[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dabe6426,#74653526);color:#dabe64;border:1px solid rgba(218,190,100,.4);border-bottom-right-radius:6px;position:relative}.user-message[_ngcontent-%COMP%]:before{content:"";position:absolute;right:-8px;bottom:0;width:0;height:0;border-style:solid;border-width:0 0 12px 8px;border-color:transparent transparent rgba(218,190,100,.4) transparent}.message-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}.message-text[_ngcontent-%COMP%]{line-height:1.5;word-wrap:break-word}.message-time[_ngcontent-%COMP%]{font-size:.7rem;opacity:.6;margin-top:8px;align-self:flex-end;color:#dabe64b3}.loading-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;animation:_ngcontent-%COMP%_slideIn .4s ease-out}.loading-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px 20px;background:linear-gradient(135deg,#1119,#1e1e1e99);border:1px solid rgba(218,190,100,.3);border-radius:20px 20px 20px 6px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.typing-indicator[_ngcontent-%COMP%]{display:flex;gap:4px}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:8px;height:8px;background:linear-gradient(45deg,#746535,#dabe64);border-radius:50%;animation:_ngcontent-%COMP%_typing 1.4s infinite ease-in-out}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}.typing-text[_ngcontent-%COMP%]{color:#dabe64cc;font-size:.9rem;font-style:italic}.input-container[_ngcontent-%COMP%]{padding:20px;background:linear-gradient(135deg,#0000004d,#1a1f2e4d);border-top:1px solid rgba(218,190,100,.2);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.input-wrapper[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.message-input[_ngcontent-%COMP%]{flex:1;padding:14px 20px;border:2px solid rgba(218,190,100,.3);border-radius:25px;outline:none;font-size:15px;background:#0000004d;color:#dabe64;transition:all .3s ease;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.message-input[_ngcontent-%COMP%]::placeholder{color:#dabe6480}.message-input[_ngcontent-%COMP%]:focus{border-color:#dabe64;box-shadow:0 0 0 3px #dabe6433;background:#0006}.send-button[_ngcontent-%COMP%]{width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,#746535,#dabe64);color:#fff;border:none;display:flex;align-items:center;justify-content:center;transition:all .3s ease;cursor:pointer;position:relative;overflow:hidden}.send-button[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,#dabe64,#746535);opacity:0;transition:opacity .3s ease}.send-button[_ngcontent-%COMP%]:hover:not(:disabled):before{opacity:1}.send-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 20px #dabe644d}.send-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;transform:none}.send-icon[_ngcontent-%COMP%], .loading-spinner[_ngcontent-%COMP%]{position:relative;z-index:2;font-size:1.1rem}.send-button.loading[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1s infinite}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_typing{0%,60%,to{transform:translateY(0);opacity:.5}30%{transform:translateY(-8px);opacity:1}}@keyframes _ngcontent-%COMP%_pulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}@media (max-width: 768px){.chatbot-container[_ngcontent-%COMP%]{border-radius:12px}.messages-container[_ngcontent-%COMP%]{padding:16px}.message[_ngcontent-%COMP%]{max-width:85%;padding:12px 16px}.input-container[_ngcontent-%COMP%]{padding:16px}.message-input[_ngcontent-%COMP%]{padding:12px 16px;font-size:14px}.send-button[_ngcontent-%COMP%]{width:46px;height:46px}}']})};var o={assetBasePath:"https://assets.l2terra.online/sprites/Skeleton_Crusader_3/PNG/PNG%20Sequences/",defaultFrameRate:12,enableProgressiveLoading:!0,enableLazyLoading:!0,loadingBatchSize:3,loadingDelay:50,movementSpeed:.15,gravity:.3,maxFallSpeed:.8,jumpPower:7,dragHoldMs:150,dragThreshold:5,minAutoWalkDistance:80,dialogDuration:3e3,dialogFadeTime:500,selectionGlowColor:"#FFD700",selectionGlowIntensity:15,dragScale:1.1,dragShadow:"0 10px 20px rgba(0, 0, 0, 0.4)",initialX:350,initialY:100,spriteWidth:100,spriteHeight:100,enableAutoWalk:!0,enableAutoBlink:!0,enableRandomDialog:!0,enableDragAndDrop:!0,enableClick:!0,useSimpleDrag:!0,enableJump:!0,autoWalkInterval:6e3,autoBlinkInterval:4e3,randomDialogInterval:6e3,blinkDuration:900,defaultDialog:"Hello, I'm the Skeleton Crusader!",dialogMessages:["Our Terra server is under development!","Click here for more information!","Stay tuned for upcoming updates!","Have questions? Tap me!","Join our Discord for more info! <button>Discord</button>","Drag and drop me!","Click on me!","Let's go for a walk!"],animations:{dying:{folder:"Dying",frames:15},fallingDown:{folder:"Falling Down",frames:6},hurt:{folder:"Hurt",frames:12},idle:{folder:"Idle",frames:18},idleBlinking:{folder:"Idle Blinking",frames:18},jumpLoop:{folder:"Jump Loop",frames:6},jumpStart:{folder:"Jump Start",frames:6},kicking:{folder:"Kicking",frames:12},runSlashing:{folder:"Run Slashing",frames:12},runThrowing:{folder:"Run Throwing",frames:12},running:{folder:"Running",frames:12},slashing:{folder:"Slashing",frames:12},slashingInTheAir:{folder:"Slashing in The Air",frames:12},sliding:{folder:"Sliding",frames:6},throwing:{folder:"Throwing",frames:12},throwingInTheAir:{folder:"Throwing in The Air",frames:12},walking:{folder:"Walking",frames:24}}},G={high:["walking","running","jumpStart","jumpLoop","kicking"],medium:["hurt","slashing","throwing","idleBlinking"],low:["dying","fallingDown","runSlashing","runThrowing","slashingInTheAir","sliding","throwingInTheAir"]},C={enableLogs:!1,enablePhysicsLogs:!1,enableAnimationLogs:!1,enableDragLogs:!1,enableDialogLogs:!1,enableLoadingLogs:!1},m={physics:(n,...t)=>{C.enableLogs&&C.enablePhysicsLogs&&console.log(`\u{1F4C9} [PHYSICS] ${n}`,...t)},animation:(n,...t)=>{C.enableLogs&&C.enableAnimationLogs&&console.log(`\u{1F3AE} [ANIMATION] ${n}`,...t)},drag:(n,...t)=>{C.enableLogs&&C.enableDragLogs&&console.log(`\u{1F3AF} [DRAG] ${n}`,...t)},dialog:(n,...t)=>{C.enableLogs&&C.enableDialogLogs&&console.log(`\u{1F4AC} [DIALOG] ${n}`,...t)},loading:(n,...t)=>{C.enableLogs&&C.enableLoadingLogs&&console.log(`\u{1F4E6} [LOADING] ${n}`,...t)},error:(n,...t)=>{console.error(`\u274C [ERROR] ${n}`,...t)},warn:(n,...t)=>{console.warn(`\u26A0\uFE0F [WARN] ${n}`,...t)}};var y=class n{_currentAnimation=new b("idle");_characterState=new b("idle");_position=new b({x:o.initialX,y:o.initialY});_physics=new b({velocity:0,jumpVelocity:0,fallSpeed:0,isJumping:!1,isFalling:!1,groundY:0});_dragState=new b({isDragging:!1,isMouseDown:!1,mouseDownTime:0,startMouseX:0,startMouseY:0,startElementX:0,startElementY:0,dragOffsetX:0,dragOffsetY:0,dragDistance:0,selecting:!1,clickFired:!1,selectionEffect:!1});_facingLeft=new b(!1);_currentFrame=new b(0);_dialog=new b("");currentAnimation$=this._currentAnimation.asObservable();characterState$=this._characterState.asObservable();position$=this._position.asObservable();physics$=this._physics.asObservable();dragState$=this._dragState.asObservable();facingLeft$=this._facingLeft.asObservable();currentFrame$=this._currentFrame.asObservable();dialog$=this._dialog.asObservable();_screenWidth=window.innerWidth;_screenHeight=window.innerHeight;_playOnce=!1;_blinkBackToIdle=!1;get currentAnimation(){return this._currentAnimation.value}get characterState(){return this._characterState.value}get position(){return this._position.value}get physics(){return this._physics.value}get dragState(){return this._dragState.value}get facingLeft(){return this._facingLeft.value}get currentFrame(){return this._currentFrame.value}get dialog(){return this._dialog.value}get screenWidth(){return this._screenWidth}get screenHeight(){return this._screenHeight}get playOnce(){return this._playOnce}get blinkBackToIdle(){return this._blinkBackToIdle}setAnimation(t,e=!1){this._currentAnimation.next(t),this._playOnce=e,this.setCurrentFrame(0),t==="idleBlinking"&&e?this._blinkBackToIdle=!0:this._blinkBackToIdle=!1}setCharacterState(t){this._characterState.next(t)}setPosition(t,e){this._position.next({x:t,y:e})}updatePosition(t){let e=this._position.value;this._position.next(x(x({},e),t))}setPhysics(t){let e=this._physics.value;this._physics.next(x(x({},e),t))}setDragState(t){let e=this._dragState.value;this._dragState.next(x(x({},e),t))}setFacingLeft(t){this._facingLeft.next(t)}setCurrentFrame(t){this._currentFrame.next(t)}setDialog(t){this._dialog.next(t)}updateScreenSize(){this._screenWidth=window.innerWidth,this._screenHeight=window.innerHeight}resetDragState(){this.setDragState({isDragging:!1,isMouseDown:!1,selecting:!1,clickFired:!1,selectionEffect:!1,dragDistance:0})}isWithinBounds(t,e){return{x:Math.max(0,Math.min(this._screenWidth-o.spriteWidth,t)),y:Math.max(0,e)}}getDistanceToTarget(t,e){let i=this.position,a=t-i.x,r=e-i.y;return Math.sqrt(a*a+r*r)}shouldFaceLeft(t){return t<this.position.x}canMove(){let t=this.dragState,e=this.physics;return!t.isDragging&&!e.isJumping&&!e.isFalling&&this.characterState!=="dying"}canJump(){let t=this.physics;return!t.isJumping&&!t.isFalling&&this.characterState!=="dying"}canInteract(){return this.characterState!=="dying"&&!this.dragState.isDragging}reset(){this.setAnimation("idle"),this.setCharacterState("idle"),this.setPosition(o.initialX,o.initialY),this.setPhysics({velocity:0,jumpVelocity:0,fallSpeed:0,isJumping:!1,isFalling:!1,groundY:0}),this.resetDragState(),this.setFacingLeft(!1),this.setDialog("")}static \u0275fac=function(e){return new(e||n)};static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};var F=class n{_imageCache=new Map;_loadingProgress=new b(0);_isLoading=new b(!1);loadingProgress$=this._loadingProgress.asObservable();isLoading$=this._isLoading.asObservable();constructor(){}get imageCache(){return this._imageCache}get isLoading(){return this._isLoading.value}get loadingProgress(){return this._loadingProgress.value}preloadAnimation(t){return S(this,null,function*(){let e=o.animations[t];if(!e){console.warn(`\u26A0\uFE0F Animaci\xF3n no encontrada: ${t}`);return}let i=[];for(let a=0;a<e.frames;a++){let r=a.toString().padStart(3,"0"),s=this.buildFrameUrl(e.folder,r);this._imageCache.has(s)||i.push(this.loadSingleImage(s))}yield Promise.all(i)})}preloadAllImagesAsync(){return S(this,null,function*(){this._isLoading.next(!0);try{yield this.loadAnimationBatch(G.high,"alta prioridad"),yield this.loadAnimationBatch(G.medium,"media prioridad"),yield this.loadAnimationBatch(G.low,"baja prioridad"),this._loadingProgress.next(100)}catch(t){console.error("\u274C Error en la precarga:",t)}finally{this._isLoading.next(!1)}})}loadAnimationBatch(t,e){return S(this,null,function*(){for(let i of t)yield this.preloadAnimation(i),this.updateProgress(),yield this.delay(o.loadingDelay)})}loadSingleImage(t){return new Promise(e=>{let i=new Image;i.onload=()=>{this._imageCache.set(t,i),e()},i.onerror=()=>{console.warn(`\u26A0\uFE0F Error cargando frame: ${t}`),e()},i.src=t})}loadImageOnDemand(t){if(this._imageCache.has(t))return;let e=new Image;e.onload=()=>{this._imageCache.set(t,e)},e.onerror=()=>{console.warn(`\u26A0\uFE0F Error cargando imagen bajo demanda: ${t}`)},e.src=t}isAnimationLoaded(t){let e=o.animations[t];if(!e)return!1;for(let i=0;i<e.frames;i++){let a=i.toString().padStart(3,"0"),r=this.buildFrameUrl(e.folder,a);if(!this._imageCache.has(r))return!1}return!0}ensureAnimationLoaded(t){this.isAnimationLoaded(t)||this.preloadAnimation(t)}getFrameUrl(t,e){let i=o.animations[t];if(!i)return"";let a=e.toString().padStart(3,"0");return this.buildFrameUrl(i.folder,a)}getFrameImage(t,e){let i=this.getFrameUrl(t,e),a=this._imageCache.get(i);return a?a.src:(this.loadImageOnDemand(i),i)}getLoadingStatus(){let t={};return Object.keys(o.animations).forEach(e=>{t[e]=this.isAnimationLoaded(e)}),t}getCacheStats(){let t=Object.keys(o.animations).length,e=Object.values(this.getLoadingStatus()).filter(i=>i).length;return{totalCached:this._imageCache.size,totalAnimations:t,percentage:Math.round(e/t*100)}}clearImageCache(){this._imageCache.clear(),this._loadingProgress.next(0)}buildFrameUrl(t,e){return`${o.assetBasePath}${t}/0_Skeleton_Crusader_${t}_${e}.png`}updateProgress(){let t=this.getCacheStats();this._loadingProgress.next(t.percentage)}delay(t){return new Promise(e=>setTimeout(e,t))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};var w=class n{constructor(t,e){this.botState=t;this.imagePreloader=e}_animationFrameId;_lastFrameTimestamp=performance.now();_frameRate=o.defaultFrameRate;startAnimation(t){t&&(this._frameRate=t),this._animationFrameId&&cancelAnimationFrame(this._animationFrameId);let e=i=>{let a=1e3/this._frameRate;i-this._lastFrameTimestamp>=a&&(this.updateFrame(),this._lastFrameTimestamp=i),this._animationFrameId=requestAnimationFrame(e)};this._animationFrameId=requestAnimationFrame(e)}stopAnimation(){this._animationFrameId&&(cancelAnimationFrame(this._animationFrameId),this._animationFrameId=null)}updateFrame(){let t=this.botState.currentAnimation,e=o.animations[t];if(!e){this.setAnimation("idle");return}let a=(this.botState.currentFrame+1)%e.frames;this.botState.setCurrentFrame(a),this.handleSpecialAnimations(t,a,e.frames)}handleSpecialAnimations(t,e,i){this.botState.blinkBackToIdle&&t==="idleBlinking"&&e===i-1&&this.setAnimation("idle"),this.botState.playOnce&&e===i-1&&this.handleOnceAnimation(t)}handleOnceAnimation(t){switch(t){case"kicking":case"hurt":case"dying":case"throwing":case"slashing":this.setAnimation("idle");break;default:break}}setAnimation(t,e=!1){if(!o.animations[t]){console.warn(`\u26A0\uFE0F Animaci\xF3n no v\xE1lida: ${t}`);return}this.imagePreloader.ensureAnimationLoaded(t),this.botState.setAnimation(t,e),m.animation(`Cambiando a animaci\xF3n: ${t}${e?" (una vez)":""}`)}getCurrentFrameUrl(){let t=this.botState.currentAnimation,e=this.botState.currentFrame;return this.imagePreloader.getFrameImage(t,e)}startBlinkAnimation(){this.botState.characterState==="idle"&&this.botState.currentAnimation==="idle"&&this.setAnimation("idleBlinking",!0)}handleMovementAnimation(t,e){if(!t){(this.botState.currentAnimation==="walking"||this.botState.currentAnimation==="running")&&this.setAnimation("idle");return}let i=e>5?"running":"walking";this.botState.currentAnimation!==i&&this.setAnimation(i)}handleJumpAnimation(t,e){t&&(e<0&&this.botState.currentAnimation!=="jumpStart"?this.setAnimation("jumpStart"):e>0&&this.botState.currentAnimation==="jumpStart"&&this.setAnimation("jumpLoop"))}handleFallAnimation(){this.botState.currentAnimation!=="fallingDown"&&this.setAnimation("fallingDown")}playOnceAnimation(t,e){if(this.setAnimation(t,!0),e){let i=o.animations[t];if(i){let a=i.frames/this._frameRate*1e3;setTimeout(e,a)}}}getAnimationDuration(t){let e=o.animations[t];return e?e.frames/this._frameRate*1e3:0}isAnimationPlaying(t){return this.botState.currentAnimation===t}getCurrentAnimationInfo(){let t=this.botState.currentAnimation,e=this.botState.currentFrame,i=o.animations[t];return{name:t,frame:e,totalFrames:i?.frames||0,progress:i?e/i.frames*100:0}}pauseAnimation(){this._animationFrameId&&(cancelAnimationFrame(this._animationFrameId),this._animationFrameId=null)}resumeAnimation(){this._animationFrameId||this.startAnimation()}cleanup(){this.stopAnimation()}static \u0275fac=function(e){return new(e||n)(g(y),g(F))};static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};var M=class n{constructor(t){this.botState=t}_dialogTimeout=null;_randomDialogInterval=null;_dialogMessages=[...o.dialogMessages];startDialogSystem(){this.setDialog(o.defaultDialog,3e3),o.enableRandomDialog&&this.startRandomDialogs()}stopDialogSystem(){this.clearCurrentDialog(),this.stopRandomDialogs()}setDialog(t,e){this.clearDialogTimeout(),this.botState.setDialog(t),m.dialog(`Di\xE1logo: "${t}"`),e&&e>0&&(this._dialogTimeout=setTimeout(()=>{this.fadeOutDialog()},e))}clearCurrentDialog(){this.clearDialogTimeout(),this.botState.setDialog("")}fadeOutDialog(){let t=document.querySelector(".dialog-bubble");t?(t.style.opacity="0",setTimeout(()=>{this.botState.setDialog("")},o.dialogFadeTime)):this.botState.setDialog("")}startRandomDialogs(){this._randomDialogInterval||(this._randomDialogInterval=setInterval(()=>{!this.botState.dialog&&this._dialogMessages.length>0&&this.showRandomDialog()},o.randomDialogInterval))}stopRandomDialogs(){this._randomDialogInterval&&(clearInterval(this._randomDialogInterval),this._randomDialogInterval=null)}showRandomDialog(){if(this._dialogMessages.length===0)return;let t=Math.floor(Math.random()*this._dialogMessages.length),e=this._dialogMessages[t];this.setDialog(e,o.dialogDuration)}clearDialogTimeout(){this._dialogTimeout&&(clearTimeout(this._dialogTimeout),this._dialogTimeout=null)}addDialogMessage(t){t&&!this._dialogMessages.includes(t)&&(this._dialogMessages.push(t),m.dialog(`Mensaje agregado: "${t}"`))}removeDialogMessage(t){let e=this._dialogMessages.indexOf(t);e>-1&&(this._dialogMessages.splice(e,1),m.dialog(`Mensaje removido: "${t}"`))}setDialogMessages(t){if(!Array.isArray(t)){console.warn("\u26A0\uFE0F Los mensajes de di\xE1logo deben ser un array");return}this._dialogMessages=[...t],m.dialog(`Lista de mensajes actualizada (${t.length} mensajes)`)}getDialogMessages(){return[...this._dialogMessages]}handleInteractionDialog(t){let i={click:["Click! Hello!","You clicked me!","Hi there!"],drag:["I'm being dragged!","Wheee!","This is fun!"],hover:["Don't come near","Stay back!","What do you want?"],jump:["Jump!","Here I go!","Flying high!"],fall:["I'm falling!","Oh no!","This is not good!"],hurt:["Ouch! That hurt!","That was painful!","Be more careful!"]}[t];if(i&&i.length>0){let a=i[Math.floor(Math.random()*i.length)],r=t==="hover"||t==="hurt"?2e3:1500;this.setDialog(a,r)}}handleContextualDialog(){let t=this.botState.characterState,e=this.botState.currentAnimation;switch(t){case"idle":Math.random()<.1&&this.setDialog("Just chilling here...",2e3);break;case"moving":Math.random()<.05&&this.setDialog("Let's go for a walk!",1500);break;case"jumping":break;case"falling":break}}showWelcomeDialog(t){let e=t?`Hello ${t}! I'm the Skeleton Crusader!`:o.defaultDialog;this.setDialog(e,4e3)}showGoodbyeDialog(){let t=["See you later!","Goodbye for now!","Until we meet again!","Take care!"],e=t[Math.floor(Math.random()*t.length)];this.setDialog(e,3e3)}getDialogState(){return{currentDialog:this.botState.dialog,hasActiveDialog:!!this.botState.dialog,messageCount:this._dialogMessages.length,isRandomDialogActive:!!this._randomDialogInterval}}pauseRandomDialogs(){this.stopRandomDialogs()}resumeRandomDialogs(){o.enableRandomDialog&&this.startRandomDialogs()}cleanup(){this.clearCurrentDialog(),this.stopRandomDialogs()}static \u0275fac=function(e){return new(e||n)(g(y))};static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};var T=class n{constructor(t,e,i){this.botState=t;this.animationHandler=e;this.dialogueHandler=i}_movementIntervalId;_autoWalkInterval;_moveCheckInterval;_autoWalkShouldResume=!1;_targetX=null;_targetY=null;startPhysics(){this.startMovementLoop(),o.enableAutoWalk&&this.startAutoWalk()}stopPhysics(){this._movementIntervalId&&(clearInterval(this._movementIntervalId),this._movementIntervalId=null),this.stopAutoWalk()}updatePhysics(){this.updateJumpPhysics(),this.updateFallPhysics(),this.updateMovement(),this.updatePosition()}updateJumpPhysics(){let t=this.botState.physics;if(!t.isJumping)return;let e=t.jumpVelocity+o.gravity,i=this.botState.position.y+e;this.botState.setPhysics({jumpVelocity:e}),this.botState.updatePosition({y:i}),this.animationHandler.handleJumpAnimation(!0,e),i>=t.groundY&&this.landFromJump()}updateFallPhysics(){let t=this.botState.physics,e=this.botState.dragState;if(!t.isFalling||e.isDragging)return;let i=o.gravity,a=o.maxFallSpeed,r=t.fallSpeed+i;r>a&&(r=a);let s=this.botState.position.y;t.fallSpeed===0&&m.physics(`Iniciando ca\xEDda desde Y=${s}`);let l=s-r;l<t.groundY&&(l=t.groundY),this.botState.updatePosition({y:l}),this.botState.setPhysics({fallSpeed:r}),m.physics(`Ca\xEDda: Y=${l.toFixed(2)}, Speed=${r.toFixed(3)}`),l===t.groundY&&this.landFromFall()}updateMovement(){let t=this.botState.dragState,e=this.botState.physics,i=this.botState.position,a=this.botState.characterState;if(t.isDragging||e.isFalling||a!=="moving"||this._targetX===null||this._targetY===null)return;let r=this._targetX-i.x,s=this._targetY-i.y,l=Math.sqrt(r*r+s*s),h=o.movementSpeed*.5;if(l<h){this.botState.setPosition(this._targetX,this._targetY),this.botState.setCharacterState("idle"),this.animationHandler.setAnimation("idle"),this._targetX=null,this._targetY=null;return}let lt=r/l*h,ee=s/l*h;this.botState.updatePosition({x:i.x+lt,y:i.y+ee}),this.botState.setFacingLeft(lt<0);let dt=this.botState.currentAnimation;dt!=="running"&&dt!=="walking"&&this.animationHandler.setAnimation("running")}updatePosition(){let t=this.botState.position;if(this.botState.dragState.isDragging)return;let i=this.botState.isWithinBounds(t.x,t.y);(i.x!==t.x||i.y!==t.y)&&this.botState.setPosition(i.x,i.y)}jump(){!this.botState.canJump()||!o.enableJump||(this.botState.setPhysics({isJumping:!0,jumpVelocity:-o.jumpPower}),this.botState.setCharacterState("jumping"),this.animationHandler.setAnimation("jumpStart"),this.dialogueHandler.setDialog("Jump!",1e3),this.pauseAutoWalk())}landFromJump(){let t=this.botState.physics;this.botState.setPosition(this.botState.position.x,t.groundY),this.botState.setPhysics({isJumping:!1,jumpVelocity:0}),this.botState.setCharacterState("idle"),this.animationHandler.setAnimation("idle"),this.dialogueHandler.setDialog("I landed!",1e3),this.resumeAutoWalk()}startFalling(){this.botState.physics.isFalling||(m.physics("Iniciando ca\xEDda"),this.botState.setPhysics({isFalling:!0,fallSpeed:0}),this.botState.setCharacterState("falling"),this.animationHandler.handleFallAnimation(),this.dialogueHandler.setDialog("I'm falling!",1500),this.pauseAutoWalk())}landFromFall(){let t=this.botState.physics;m.physics("Aterrizando desde ca\xEDda"),this.botState.setPosition(this.botState.position.x,t.groundY),this.botState.setPhysics({isFalling:!1,fallSpeed:0}),this.animationHandler.setAnimation("hurt",!0),this.dialogueHandler.setDialog("Ouch! That hurt!",2e3),setTimeout(()=>{this.botState.setCharacterState("idle"),this.animationHandler.setAnimation("idle"),this.resumeAutoWalk()},1e3)}moveTo(t,e=this.botState.physics.groundY){if(!this.botState.canMove())return;let i=this.botState.isWithinBounds(t,e),a=this.botState.shouldFaceLeft(i.x);this.botState.setFacingLeft(a),this._targetX=i.x,this._targetY=i.y,this.botState.setCharacterState("moving"),this.animationHandler.setAnimation("running")}stopMoving(){this.botState.setCharacterState("idle"),this.animationHandler.setAnimation("idle"),this._moveCheckInterval&&(clearInterval(this._moveCheckInterval),this._moveCheckInterval=null),this._targetX=null,this._targetY=null}startMovementLoop(){this._movementIntervalId&&clearInterval(this._movementIntervalId),this._movementIntervalId=setInterval(()=>{this.botState.updateScreenSize(),this.updatePhysics()},16)}startAutoWalk(){this._autoWalkInterval||!o.enableAutoWalk||(this._autoWalkInterval=setInterval(()=>{let t=this.botState.characterState,e=this.botState.dragState,i=this.botState.physics;t==="idle"&&!e.isDragging&&!i.isJumping&&!i.isFalling&&this.performAutoWalk()},o.autoWalkInterval))}performAutoWalk(){let t=this.botState.screenWidth,e=50,i=t-o.spriteWidth-50,a;do a=Math.floor(Math.random()*(i-e+1))+e;while(Math.abs(this.botState.position.x-a)<o.minAutoWalkDistance);this.moveTo(a)}pauseAutoWalk(){this._autoWalkInterval&&(clearInterval(this._autoWalkInterval),this._autoWalkInterval=null,this._autoWalkShouldResume=!0)}resumeAutoWalk(){this._autoWalkShouldResume&&o.enableAutoWalk&&(this.startAutoWalk(),this._autoWalkShouldResume=!1)}stopAutoWalk(){this._autoWalkInterval&&(clearInterval(this._autoWalkInterval),this._autoWalkInterval=null),this._autoWalkShouldResume=!1}cleanup(){this.stopPhysics(),this.stopAutoWalk()}static \u0275fac=function(e){return new(e||n)(g(y),g(w),g(M))};static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};var J=class n{constructor(t,e,i,a){this.botState=t;this.animationHandler=e;this.dialogueHandler=i;this.physicsHandler=a}_dragHoldTimeout=null;_spriteElement=null;initialize(t){this._spriteElement=t}onMouseDown(t){if(!this.canInteract())return;t.preventDefault(),t.stopPropagation();let e=this.getSpriteRect();e&&(this.botState.setDragState({isMouseDown:!0,mouseDownTime:Date.now(),startMouseX:t.clientX,startMouseY:t.clientY,startElementX:this.botState.position.x,startElementY:this.botState.position.y,dragOffsetX:t.clientX-e.left,dragOffsetY:t.clientY-e.top,dragDistance:0,selecting:!0,selectionEffect:!0,clickFired:!1}),o.enableDragAndDrop&&o.useSimpleDrag&&(this._dragHoldTimeout=setTimeout(()=>{this.botState.dragState.isMouseDown&&!this.botState.dragState.isDragging&&this.startDragging()},o.dragHoldMs)))}onMouseMove(t){let e=this.botState.dragState;if(!e.isMouseDown)return;let i=t.clientX-e.startMouseX,a=t.clientY-e.startMouseY,r=Math.sqrt(i*i+a*a);this.botState.setDragState({dragDistance:r}),r>o.dragThreshold&&!e.isDragging&&o.enableDragAndDrop&&this.startDragging(),e.isDragging&&this.updateDragPosition(t)}onMouseUp(t){let e=this.botState.dragState;this.clearDragTimeout(),e.selecting&&!e.isDragging&&!e.clickFired&&o.enableClick&&this.handleClick(),e.isDragging&&this.endDragging(),this.resetDragState()}onMouseLeave(t){this.botState.dragState.isDragging&&this.endDragging(),this.resetDragState()}onMouseEnter(t){this.physicsHandler.pauseAutoWalk(),this.animationHandler.setAnimation("runSlashing"),this.dialogueHandler.handleInteractionDialog("hover"),setTimeout(()=>{this.botState.currentAnimation==="runSlashing"&&this.animationHandler.setAnimation("idle"),this.physicsHandler.resumeAutoWalk()},500)}startDragging(){this.botState.dragState.isDragging||(m.drag("Iniciando drag..."),this.botState.setDragState({isDragging:!0,clickFired:!0,selecting:!1,selectionEffect:!1}),this.animationHandler.setAnimation("slashing"),this.dialogueHandler.handleInteractionDialog("drag"),this.physicsHandler.pauseAutoWalk(),this.applyDragStyles(!0))}updateDragPosition(t){let e=this.botState.dragState,i=this.botState.screenHeight,a=this.botState.screenWidth,r=t.clientX-e.dragOffsetX,s=i-(t.clientY-e.dragOffsetY)-o.spriteHeight,l=Math.max(0,Math.min(a-o.spriteWidth,r)),h=Math.max(0,s);this.botState.setPosition(l,h),m.drag(`Posici\xF3n durante drag: X=${l}, Y=${h}`),this.updateElementPosition(l,h)}endDragging(){m.drag("Finalizando drag..."),this.botState.setDragState({isDragging:!1}),this.applyDragStyles(!1);let t=this.botState.physics,e=this.botState.position;m.drag(`Posici\xF3n final del drag: X=${e.x}, Y=${e.y}, GroundY=${t.groundY}`),e.y>t.groundY?this.physicsHandler.startFalling():(this.animationHandler.setAnimation("idle"),this.botState.setCharacterState("idle"),this.dialogueHandler.setDialog("I'm not being dragged anymore!",1500),this.physicsHandler.resumeAutoWalk())}handleClick(){m.drag("Click detectado"),this.animationHandler.playOnceAnimation("kicking",()=>{this.botState.currentAnimation==="kicking"&&this.animationHandler.setAnimation("idle")}),this.dialogueHandler.handleInteractionDialog("click"),this.emitCustomClickEvent()}emitCustomClickEvent(){if(!this._spriteElement?.nativeElement.parentElement)return;let t=this.botState.position,e=new CustomEvent("skeletonClick",{detail:{x:t.x,y:t.y}});this._spriteElement.nativeElement.parentElement.dispatchEvent(e)}resetDragState(){this.botState.resetDragState(),this.clearDragTimeout()}clearDragTimeout(){this._dragHoldTimeout&&(clearTimeout(this._dragHoldTimeout),this._dragHoldTimeout=null)}applyDragStyles(t){let e=this._spriteElement?.nativeElement.parentElement;e&&(t?(e.style.zIndex="1001",e.classList.add("dragging")):(e.style.zIndex="1000",e.classList.remove("dragging")))}updateElementPosition(t,e){let i=this._spriteElement?.nativeElement.parentElement;i&&(i.style.position="fixed",i.style.left=t+"px",i.style.bottom=e+"px",i.style.transition="none")}getSpriteRect(){return this._spriteElement?.nativeElement.parentElement?.getBoundingClientRect()||null}canInteract(){return o.enableDragAndDrop||o.enableClick}getDragState(){let t=this.botState.dragState;return{isDragging:t.isDragging,isSelecting:t.selecting,canDrag:o.enableDragAndDrop,canClick:o.enableClick}}forceDragEnd(){this.botState.dragState.isDragging&&(this.endDragging(),this.resetDragState())}setDragEnabled(t){m.drag(`Drag ${t?"habilitado":"deshabilitado"}`),!t&&this.botState.dragState.isDragging&&this.forceDragEnd()}simulateClick(){o.enableClick&&this.botState.canInteract()&&this.handleClick()}cleanup(){this.clearDragTimeout(),this.resetDragState(),this._spriteElement=null}static \u0275fac=function(e){return new(e||n)(g(y),g(w),g(M),g(T))};static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};var pe=["sprite"];function he(n,t){if(n&1&&(d(0,"div",5),D(1),c()),n&2){let e=_t();p(),Dt(" ",e.dialog," ")}}var Q=class n{constructor(t,e,i,a,r,s){this.botState=t;this.imagePreloader=e;this.animationHandler=i;this.physicsHandler=a;this.dialogueHandler=r;this.dragHandler=s}spriteRef;frameRate=o.defaultFrameRate;animation="idle";destroy$=new mt;currentX=o.initialX;currentY=o.initialY;facingLeft=!1;dialog="";isDragging=!1;selecting=!1;config=o;ngOnInit(){this.applyCSSConfig(),this.initializeHandlers(),this.subscribeToStateChanges(),this.startBasicMode()}ngOnChanges(t){t.animation&&!t.animation.firstChange&&this.animationHandler.setAnimation(this.animation),t.frameRate&&!t.frameRate.firstChange&&this.animationHandler.startAnimation(this.frameRate)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.cleanupHandlers()}initializeHandlers(){this.dragHandler.initialize(this.spriteRef),this.animationHandler.startAnimation(this.frameRate),this.physicsHandler.startPhysics(),this.dialogueHandler.startDialogSystem()}subscribeToStateChanges(){this.botState.position$.pipe(E(this.destroy$)).subscribe(t=>{this.currentX=t.x,this.currentY=t.y,this.updateDOMPosition()}),this.botState.facingLeft$.pipe(E(this.destroy$)).subscribe(t=>{this.facingLeft=t,this.updateSpriteDirection()}),this.botState.dialog$.pipe(E(this.destroy$)).subscribe(t=>{this.dialog=t}),this.botState.dragState$.pipe(E(this.destroy$)).subscribe(t=>{this.isDragging=t.isDragging,this.selecting=t.selecting})}startBasicMode(){return S(this,null,function*(){try{yield this.imagePreloader.preloadAnimation("idle"),o.enableProgressiveLoading&&setTimeout(()=>{this.imagePreloader.preloadAllImagesAsync()},100)}catch(t){console.error("\u274C Error en modo b\xE1sico:",t)}})}updateDOMPosition(){let t=this.spriteRef.nativeElement.parentElement;t&&!this.isDragging&&(t.style.position="fixed",t.style.left=this.currentX+"px",t.style.bottom=this.currentY+"px",t.style.transition="none")}updateSpriteDirection(){let t=this.spriteRef.nativeElement;t&&(t.style.transform=this.facingLeft?"scaleX(-1)":"scaleX(1)")}applyCSSConfig(){let t=this.spriteRef.nativeElement.parentElement?.parentElement;t&&(t.style.setProperty("--skeleton-sprite-width",`${o.spriteWidth}px`),t.style.setProperty("--skeleton-sprite-height",`${o.spriteHeight}px`),t.style.setProperty("--skeleton-drag-scale",o.dragScale.toString()),t.style.setProperty("--skeleton-drag-shadow",o.dragShadow),t.style.setProperty("--skeleton-selection-glow-color",o.selectionGlowColor),t.style.setProperty("--skeleton-selection-glow-intensity",`${o.selectionGlowIntensity}px`)),this.ensureFixedPosition()}ensureFixedPosition(){let t=this.spriteRef.nativeElement.parentElement;t&&(t.style.position="fixed",t.style.bottom=this.currentY+"px",t.style.left=this.currentX+"px",t.style.transition="none",t.style.zIndex="1000")}getFrameSrc(){return this.animationHandler.getCurrentFrameUrl()}onImageError(t){let e=t.target;(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&(console.error(`\u274C Error cargando imagen: ${e.src}`),console.error("\u{1F3AE} Verificar CORS o ruta del asset"))}onMouseEnter(t){this.dragHandler.onMouseEnter(t)}onMouseDown(t){this.dragHandler.onMouseDown(t)}onMouseMove(t){this.dragHandler.onMouseMove(t)}onMouseUp(t){this.dragHandler.onMouseUp(t)}onMouseLeave(t){this.dragHandler.onMouseLeave(t)}onKeyDown(t){t.code==="Space"&&o.enableJump&&(t.preventDefault(),this.physicsHandler.jump())}onWindowResize(){this.botState.updateScreenSize()}play(t){this.animationHandler.setAnimation(t),this.botState.setCharacterState("custom")}die(){this.animationHandler.playOnceAnimation("dying",()=>{this.animationHandler.setAnimation("idle"),this.botState.setCharacterState("idle"),this.dialogueHandler.setDialog("I'm alive again!",2e3)}),this.botState.setCharacterState("dying"),this.dialogueHandler.setDialog("I'm dying!",2500)}moveTo(t,e){this.physicsHandler.moveTo(t,e)}jump(){this.physicsHandler.jump()}addDialogMessage(t){this.dialogueHandler.addDialogMessage(t)}setDialogMessages(t){this.dialogueHandler.setDialogMessages(t)}setDialog(t,e){this.dialogueHandler.setDialog(t,e)}forceLoadAnimation(t){return S(this,null,function*(){return this.imagePreloader.preloadAnimation(t)})}getLoadingStatus(){return this.imagePreloader.getLoadingStatus()}getCacheStats(){return this.imagePreloader.getCacheStats()}clearImageCache(){this.imagePreloader.clearImageCache()}getBotState(){return{animation:this.botState.currentAnimation,state:this.botState.characterState,position:this.botState.position,physics:this.botState.physics,dragState:this.dragHandler.getDragState(),dialogState:this.dialogueHandler.getDialogState()}}cleanupHandlers(){this.animationHandler.cleanup(),this.physicsHandler.cleanup(),this.dialogueHandler.cleanup(),this.dragHandler.cleanup()}static \u0275fac=function(e){return new(e||n)(A(y),A(F),A(w),A(T),A(M),A(J))};static \u0275cmp=O({type:n,selectors:[["app-mini-ak4n1"]],viewQuery:function(e,i){if(e&1&&L(pe,7),e&2){let a;R(a=j())&&(i.spriteRef=a.first)}},hostBindings:function(e,i){e&1&&H("mouseenter",function(r){return i.onMouseEnter(r)})("mousedown",function(r){return i.onMouseDown(r)})("mousemove",function(r){return i.onMouseMove(r)},!1,et)("mouseup",function(r){return i.onMouseUp(r)},!1,et)("mouseleave",function(r){return i.onMouseLeave(r)})("keydown",function(r){return i.onKeyDown(r)},!1,tt)("resize",function(r){return i.onWindowResize(r)},!1,tt)},inputs:{frameRate:"frameRate",animation:"animation"},features:[ft],decls:5,vars:8,consts:[["sprite",""],[1,"skeleton-wrapper"],[1,"sprite-container"],["class","dialog-bubble",4,"ngIf"],[1,"sprite",3,"error","src","alt"],[1,"dialog-bubble"]],template:function(e,i){if(e&1){let a=z();d(0,"div",1)(1,"div",2),B(2,he,2,1,"div",3),d(3,"img",4,0),H("error",function(s){return I(a),P(i.onImageError(s))}),c()()()}e&2&&(p(),$("dragging",i.isDragging)("selecting",i.selecting),St("data-draggable",i.config.enableDragAndDrop),p(),f("ngIf",i.dialog),p(),f("src",i.getFrameSrc(),vt)("alt",i.animation))},dependencies:[X,N],styles:['[_nghost-%COMP%]{display:inline-block;position:fixed;bottom:0;left:0;-webkit-user-select:none;user-select:none;z-index:10;cursor:grab;transition:none;will-change:transform;pointer-events:auto;--skeleton-sprite-width: 100px;--skeleton-sprite-height: 100px;--skeleton-drag-scale: 1.05;--skeleton-drag-shadow: 0 8px 16px rgba(0, 0, 0, .3);--skeleton-selection-glow-color: #FFD700;--skeleton-selection-glow-intensity: 20px;--skeleton-dialog-bg-color: rgba(0, 0, 0, .8);--skeleton-dialog-text-color: white;--skeleton-shadow-color: rgba(0, 0, 0, .3)}.skeleton-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block}.sprite-container[_ngcontent-%COMP%]{display:block;position:relative;transition:none;pointer-events:auto}.sprite-container.dragging[_ngcontent-%COMP%]{cursor:grabbing;filter:drop-shadow(var(--skeleton-drag-shadow));transform:scale(var(--skeleton-drag-scale));z-index:1000}.sprite-container.selecting[_ngcontent-%COMP%]{cursor:pointer;filter:drop-shadow(0 0 var(--skeleton-selection-glow-intensity) var(--skeleton-selection-glow-color))}.sprite[_ngcontent-%COMP%]{display:block;width:var(--skeleton-sprite-width);height:var(--skeleton-sprite-height);image-rendering:pixelated;image-rendering:-moz-crisp-edges;image-rendering:crisp-edges;-webkit-user-select:none;user-select:none;pointer-events:none;transition:none}.dialog-bubble[_ngcontent-%COMP%]{position:absolute;top:-50px;left:50%;transform:translate(-50%);background:var(--skeleton-dialog-bg-color);color:var(--skeleton-dialog-text-color);padding:10px 15px;border-radius:20px;font-size:14px;font-weight:500;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;white-space:nowrap;z-index:1001;pointer-events:none;box-shadow:0 4px 12px #dabe64;text-align:center;animation:_ngcontent-%COMP%_dialogFadeIn .3s ease-out;transition:opacity .2s ease-out}.dialog-bubble[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-8px;left:50%;transform:translate(-50%);width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--skeleton-dialog-bg-color)}@keyframes _ngcontent-%COMP%_dialogFadeIn{0%{opacity:0;transform:translate(-50%) translateY(-10px)}to{opacity:1;transform:translate(-50%) translateY(0)}}.sprite-container[_ngcontent-%COMP%]:before{content:"";position:absolute;bottom:-10px;left:50%;transform:translate(-50%);width:60px;height:15px;background:var(--skeleton-shadow-color);border-radius:50%;z-index:-1}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-disabled[_ngcontent-%COMP%]{cursor:default!important}']})};var q=class n{static \u0275fac=function(e){return new(e||n)};static \u0275cmp=O({type:n,selectors:[["app-root"]],decls:11,vars:0,consts:[["tabindex","-1","id","offCanvasChat","aria-labelledby","offCanvasChatLabel",1,"offcanvas","offcanvas-end","chatbot-container"],["src","","alt","","srcset",""],[1,"offcanvas-header"],["id","offCanvasChatLabel",1,"offcanvas-title"],[1,"fa-solid","fa-robot"],["type","button","data-bs-dismiss","offcanvas","aria-label","Cerrar",1,"btn-close","text-reset"],[1,"offcanvas-body","p-0"]],template:function(e,i){e&1&&(v(0,"router-outlet"),d(1,"div",0),v(2,"img",1),d(3,"div",2)(4,"h5",3),v(5,"i",4),D(6," Terra Assistant"),c(),v(7,"button",5),c(),d(8,"div",6),v(9,"app-botterra"),c()(),v(10,"app-mini-ak4n1"))},dependencies:[Wt,V,Q],styles:['.button-assistant[_ngcontent-%COMP%]{position:fixed;bottom:10%;right:50px;z-index:999;width:60px;height:60px;padding:10px;font-size:24px;background:linear-gradient(to right,#746535,#dabe64);color:#fff;border:none;border-radius:50%;box-shadow:0 2px 8px #0000004d;display:flex;align-items:center;justify-content:center;transition:transform .2s ease}.button-assistant[_ngcontent-%COMP%]:hover{transform:scale(1.05);padding:15px}.chatbot-container[_ngcontent-%COMP%]{background:linear-gradient(to bottom,#0c0f20,#000)}.offcanvas-title[_ngcontent-%COMP%]{color:#dabe64}.btn-close[_ngcontent-%COMP%]{filter:none!important;background-image:none!important;color:#dabe64!important;font-size:1.5rem;position:relative}.btn-close[_ngcontent-%COMP%]:before{content:"\\d7";color:#dabe64;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-weight:700;font-size:2.5rem}']})};Tt(q,Qt).catch(n=>console.error(n));
