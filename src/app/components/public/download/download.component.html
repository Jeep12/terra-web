<app-preload></app-preload>
<div class="download-container" #downloadContainer>


  <!-- Header Section -->
  <div class="download-header">
    <div class="header-content">
      <h1 class="header-title">Download Terra L2</h1>
      <p class="header-subtitle">Follow these steps to install and play on our server</p>

      <br>
      <br>
    </div>

    <!-- Steps Navigation Bar -->
    <div class="steps-navbar">
      <div class="steps-nav-container">
        <!-- Primera fila: Steps 1-6 -->
        <div class="steps-nav-row">
          <div class="step-nav-item step-{{ step.id }}" *ngFor="let step of downloadSteps.slice(0, 6); let i = index"
            [class.active]="step.id === currentStep" [class.completed]="step.completed" (click)="goToStep(step.id)">
            <div class="step-nav-content" [attr.data-step-number]="step.id">
              <div class="step-nav-title">{{ step.title }}</div>
            </div>
          </div>
        </div>

        <!-- Segunda fila: Step 7 (PLAY!) -->
        <div class="steps-nav-row">
          <div class="step-nav-item step-{{ step.id }}" *ngFor="let step of downloadSteps.slice(6); let i = index"
            [class.active]="step.id === currentStep" [class.completed]="step.completed" (click)="goToStep(step.id)">
            <div class="step-nav-content" [attr.data-step-number]="step.id">
              <div class="step-nav-title">{{ step.title }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-section">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="(currentStep / downloadSteps.length) * 100"></div>
      </div>
      <div class="progress-text">
        Step {{ currentStep }} of {{ downloadSteps.length }}
      </div>
    </div>

    <!-- Steps Container -->
    <div class="steps-container">
      <div class="step-card" *ngFor="let step of downloadSteps; let i = index" [class.active]="step.id === currentStep"
        [class.completed]="step.completed">

        <!-- Step Header -->
        <div class="step-header">
          <div class="step-info">
            <h3 class="step-title">{{ step.title }}</h3>
            <p class="step-description">{{ step.description }}</p>
          </div>
          <div class="step-icon">
            <i [class]="step.icon"></i>
          </div>
        </div>

        <!-- Step Content -->
        <div class="step-content" *ngIf="step.id === currentStep">

          <!-- Warnings Section -->
          <div class="warnings-section" *ngIf="step.warnings && step.warnings.length > 0">
            <h4 class="warnings-title">
              Important Warnings
            </h4>
            <div class="warnings-list">
              <div class="warning-item" *ngFor="let warning of step.warnings">
                <span class="warning-text">{{ warning }}</span>
              </div>
            </div>
          </div>

          <!-- Requirements Step -->
          <div class="requirements-list" *ngIf="step.id === 1">
            <div class="requirement-item">
              <i class="fab fa-windows"></i>
              <span>Windows 7/8/10/11 (64-bit)</span>
            </div>
            <div class="requirement-item">
              <i class="fas fa-microchip"></i>
              <span>Processor: Intel Core i3 or AMD equivalent</span>
            </div>
            <div class="requirement-item">
              <i class="fas fa-memory"></i>
              <span>RAM: 4GB minimum, 8GB recommended</span>
            </div>
            <div class="requirement-item">
              <i class="fas fa-tv"></i>
              <span>Graphics card: DirectX 11 compatible</span>
            </div>
            <div class="requirement-item">
              <i class="fas fa-hdd"></i>
              <span>Disk space: 8GB free</span>
            </div>
            <div class="requirement-item">
              <i class="fas fa-wifi"></i>
              <span>Stable Internet connection</span>
            </div>
          </div>

          <!-- Download Section -->
          <div class="download-section" *ngIf="step.id === 2 || step.id === 4">
            <div class="file-info">
              <div class="file-icon">
                <img [src]="step.launcherIcon" [alt]="step.title" class="file-icon-img" *ngIf="step.launcherIcon">
                <i class="fas fa-file-archive" *ngIf="!step.launcherIcon"></i>
              </div>
              <div class="file-details">
                <h4>{{ step.fileName }}</h4>
                <div style="text-align: start;" class="file-size">{{ step.fileSize }}</div>
              </div>
            </div>
            <div class="download-actions">
              <div class="download-buttons-grid">
                <!-- Google Drive - Recomendado y habilitado -->
                <button class="download-btn btn-primary recommended"
                  (click)="downloadFile(step.downloadUrl, step.fileName)">
                  <i class="fab fa-google-drive"></i>
                  <span>Google Drive</span>
                  <span class="recommended-badge">Recommended</span>
                </button>

                <!-- MediaFire - Deshabilitado -->
                <button class="download-btn btn-secondary disabled" disabled>
                  <i class="fas fa-cloud-download-alt"></i>
                  <span>MediaFire</span>
                  <span class="disabled-badge">Coming Soon</span>
                </button>

                <!-- GoFile - Deshabilitado -->
                <button class="download-btn btn-secondary disabled" disabled>
                  <i class="fas fa-file-download"></i>
                  <span>GoFile</span>
                  <span class="disabled-badge">Coming Soon</span>
                </button>
              </div>
            </div>
          </div>

          <!-- General Instructions Section -->
          <div class="instructions-section" *ngIf="step.instructions && step.instructions.length > 0 && step.id !== 6">
            <h4 class="instructions-title">
              Instructions
            </h4>
            <div class="instructions-list">
              <div class="instruction-item" *ngFor="let instruction of step.instructions; let i = index">
                <div class="instruction-number">{{ i + 1 }}</div>
                <div class="instruction-text" *ngIf="step.id !== 7" [innerHTML]="sanitizeHtml(instruction)"></div>
                <div class="instruction-text" *ngIf="step.id === 7">
                  <ng-container [ngSwitch]="i">
                    <ng-container *ngSwitchCase="0">{{ instruction }}</ng-container>
                    <ng-container *ngSwitchCase="1">
                      Create your Master Account at <a routerLink="/register" class="register-link">Register Page</a>
                    </ng-container>
                    <ng-container *ngSwitchDefault>{{ instruction }}</ng-container>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>

          <!-- Instructions with Launcher -->
          <div class="instructions-with-launcher" *ngIf="step.id === 6">
            <div class="launcher-section">
              <div class="launcher-preview">
                <div class="launcher-icon-container">
                  <img [src]="step.launcherIcon" [alt]="step.title" class="launcher-icon">
                </div>
              </div>
            </div>
            <div class="instructions-section">
              <div class="instructions-list">
                <div class="instruction-item" *ngFor="let instruction of step.instructions; let i = index">
                  <div class="instruction-number">{{ i + 1 }}</div>
                  <div class="instruction-text" [innerHTML]="sanitizeHtml(instruction)"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tips Section -->
          <div class="tips-section" *ngIf="step.tips && step.tips.length > 0">
            <h4 class="tips-title">
              Useful Tips
            </h4>
            <div class="tips-list">
              <div class="tip-item" *ngFor="let tip of step.tips; let i = index">
                <span class="tip-text" [innerHTML]="sanitizeHtml(tip)"></span>
              </div>
            </div>
          </div>

          <!-- Navigation Buttons -->
          <div class="navigation-buttons" *ngIf="step.id === currentStep">
            <div class="nav-buttons-container">
              <button class="nav-btn btn-previous" [disabled]="currentStep === 1" (click)="previousStep()">
                <i class="fas fa-chevron-left"></i>
                <span>Previous</span>
              </button>

              <button class="nav-btn btn-next" [disabled]="currentStep === downloadSteps.length" (click)="nextStep()">
                <span>Next</span>
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Help Section -->
    <div class="help-section">
      <div class="help-card">
        <div class="help-header">
          <i class="fas fa-question-circle"></i>
          <h3>Need Help?</h3>
        </div>
        <div class="help-content">
          <p>If you have problems during installation:</p>
          <ul>
            <li>Join our <a href="#" class="help-link">Discord</a></li>
            <li>And contact us so we can help you!</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Video Section -->
    <div class="video-section">
      <div class="video-container">
        <h3>Installation Tutorial</h3>
        <video width="100%" src="assets/videos/video_instalacion.mp4" controls>
          Your browser does not support the video element.
        </video>
      </div>
    </div>


  </div>