<div class="change-password-container fadeInUp">
  <div class="form-wrapper">
    <div class="form-header">
      <h2>Change Password</h2>
      <p>Select account and update your password</p>
    </div>

    <div class="account-carousel" *ngIf="gameAccounts.length > 0; else noAccounts">
      <div class="carousel-header">
        <h3>Select Account</h3>
        <span class="account-counter">{{ currentAccountIndex + 1 }} / {{ gameAccounts.length }}</span>
      </div>

      <div class="carousel-container">
        <button class="carousel-btn prev" (click)="previousAccount()">
          <i class="fa-solid fa-chevron-left"></i>
        </button>

        <div class="account-card" *ngIf="selectedAccount">
          <div class="account-info">
            <h4>{{ selectedAccount.login }}</h4>
            <div class="account-details">

              <span><span style="color: #998648;">Created: </span>{{ formatDate(selectedAccount.createdTime) }}</span>

              <span><span style="color: #998648;">Last Active: </span>{{ selectedAccount.lastActive | date:'medium'
                }}</span>

              <span><span style="color: #998648;">Last IP: </span>{{ selectedAccount.lastIP }}</span>

              <span><span style="color: #998648;">Last Server: </span>{{ selectedAccount.lastServer }}</span>

              <span><span style="color: #998648;">PC IP:</span> {{ selectedAccount.pcIp }}</span>
            </div>
          </div>
        </div>

        <button class="carousel-btn next" (click)="nextAccount()">
          <i class="fa-solid fa-chevron-right"></i>
        </button>
      </div>
    </div>

    <ng-template #noAccounts>
      <p>No accounts found.</p>
    </ng-template>

    <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" class="password-form" *ngIf="selectedAccount">
      <div class="form-group">
        <label for="newPassword"><i class="fa-solid fa-key"></i> New Password</label>
        <input type="password" id="newPassword" formControlName="newPassword" placeholder="Enter new password"
          [class.error]="getFieldError('newPassword')" autocomplete="new-password" />
        <span class="error-message" *ngIf="getFieldError('newPassword')">{{ getFieldError('newPassword') }}</span>
      </div>

      <div class="form-group">
        <label for="confirmNewPassword"><i class="fa-solid fa-key"></i> Confirm New Password</label>
        <input type="password" id="confirmNewPassword" formControlName="confirmNewPassword"
          placeholder="Confirm new password" [class.error]="getFieldError('confirmNewPassword')"
          autocomplete="new-password" />
        <span class="error-message" *ngIf="getFieldError('confirmNewPassword')">{{ getFieldError('confirmNewPassword')
          }}</span>
      </div>

      <div class="form-group">
        <!-- Mensaje de respuesta -->
        <div *ngIf="responseMessage && !emailSent" class="response-message">
          <div class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-triangle text-danger"></i> {{ responseMessage }}
          </div>
        </div>

        <div class="accordion" id="accordionPanelsStayOpenExample">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button" type="button" data-bs-toggle="collapse"
                data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true"
                aria-controls="panelsStayOpen-collapseOne">
               <i class="fa-solid fa-envelope-open-text"></i>&nbsp; Security code

              </button>
            </h2>
            <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse">
              <div class="accordion-body">

                <button (click)="sendEmailCodeAccount()" type="submit" class="btn-secondary" [disabled]="loading">
                  <div class="loading-container" *ngIf="loading">
                    <div class="loading-bar"></div>
                  </div>
                  <i class="fas fa-paper-plane"></i>
                  {{ loading ? '' : 'Send reset code' }}
                </button>

                <hr>
                <div class="container-input-code">
                  <label><i class="fa-solid fa-lock"></i> Enter Code</label>
                  <div class="code-input-wrapper">
                    <input maxlength="1" type="text" *ngFor="let ctrl of codeInputs; let i = index"
                      formControlName="code{{i}}" (input)="onInputChange($event, i)" (paste)="onPaste($event)"
                      class="code-input" />

                  </div>
                </div>



              </div>
            </div>
          </div>


        </div>



      </div>

      <button type="submit" class="btn-change"
        [disabled]="changePasswordForm.invalid || isSubmitting || !selectedAccount">
        <i class="fa-solid fa-user-lock" *ngIf="!isSubmitting"></i>
        <i class="fa-solid fa-spinner fa-spin" *ngIf="isSubmitting"></i>
        {{ isSubmitting ? 'Changing Password...' : 'Change Password' }}
      </button>
    </form>
  </div>
</div>


<!-- Success Modal -->
<div #successModal class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content auth-modal">
      <div class="modal-header border-0 justify-content-center">
        <div class="success-icon">
          <i class="fas fa-envelope-open-text"></i>
        </div>
      </div>
      <div class="modal-body text-center">
        <h3>Verification Email Sent!</h3>
        <p>
          We've sent you a verification link.
          Please check your inbox <strong>and</strong> spam folder.
          The link expires in <strong>15 minutes</strong>.
        </p>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times-circle"></i> Close
        </button>
      </div>
    </div>
  </div>
</div>